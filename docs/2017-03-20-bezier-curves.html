<!DOCTYPE html>
<html class='v2' dir='ltr'>
<head>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<title>Programming as Composing</title>

</head>

<link href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css" rel="stylesheet" type="text/css"></link>
<style>
  body { background-color: #eeeeee; }
  pre, code { font-size: 16px; background-color: white; }
</style>

<script src="https://cdn.rawgit.com/jnordberg/gif.js/master/dist/gif.js"></script>
<script id="gif-js-worker-code" type="text/javascript">
// gif.worker.js 0.2.0 - https://github.com/jnordberg/gif.js
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var NeuQuant=require("./TypedNeuQuant.js");var LZWEncoder=require("./LZWEncoder.js");function ByteArray(){this.page=-1;this.pages=[];this.newPage()}ByteArray.pageSize=4096;ByteArray.charMap={};for(var i=0;i<256;i++)ByteArray.charMap[i]=String.fromCharCode(i);ByteArray.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(ByteArray.pageSize);this.cursor=0};ByteArray.prototype.getData=function(){var rv="";for(var p=0;p<this.pages.length;p++){for(var i=0;i<ByteArray.pageSize;i++){rv+=ByteArray.charMap[this.pages[p][i]]}}return rv};ByteArray.prototype.writeByte=function(val){if(this.cursor>=ByteArray.pageSize)this.newPage();this.pages[this.page][this.cursor++]=val};ByteArray.prototype.writeUTFBytes=function(string){for(var l=string.length,i=0;i<l;i++)this.writeByte(string.charCodeAt(i))};ByteArray.prototype.writeBytes=function(array,offset,length){for(var l=length||array.length,i=offset||0;i<l;i++)this.writeByte(array[i])};function GIFEncoder(width,height){this.width=~~width;this.height=~~height;this.transparent=null;this.transIndex=0;this.repeat=-1;this.delay=0;this.image=null;this.pixels=null;this.indexedPixels=null;this.colorDepth=null;this.colorTab=null;this.neuQuant=null;this.usedEntry=new Array;this.palSize=7;this.dispose=-1;this.firstFrame=true;this.sample=10;this.dither=false;this.globalPalette=false;this.out=new ByteArray}GIFEncoder.prototype.setDelay=function(milliseconds){this.delay=Math.round(milliseconds/10)};GIFEncoder.prototype.setFrameRate=function(fps){this.delay=Math.round(100/fps)};GIFEncoder.prototype.setDispose=function(disposalCode){if(disposalCode>=0)this.dispose=disposalCode};GIFEncoder.prototype.setRepeat=function(repeat){this.repeat=repeat};GIFEncoder.prototype.setTransparent=function(color){this.transparent=color};GIFEncoder.prototype.addFrame=function(imageData){this.image=imageData;this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null;this.getImagePixels();this.analyzePixels();if(this.globalPalette===true)this.globalPalette=this.colorTab;if(this.firstFrame){this.writeLSD();this.writePalette();if(this.repeat>=0){this.writeNetscapeExt()}}this.writeGraphicCtrlExt();this.writeImageDesc();if(!this.firstFrame&&!this.globalPalette)this.writePalette();this.writePixels();this.firstFrame=false};GIFEncoder.prototype.finish=function(){this.out.writeByte(59)};GIFEncoder.prototype.setQuality=function(quality){if(quality<1)quality=1;this.sample=quality};GIFEncoder.prototype.setDither=function(dither){if(dither===true)dither="FloydSteinberg";this.dither=dither};GIFEncoder.prototype.setGlobalPalette=function(palette){this.globalPalette=palette};GIFEncoder.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette};GIFEncoder.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")};GIFEncoder.prototype.analyzePixels=function(){if(!this.colorTab){this.neuQuant=new NeuQuant(this.pixels,this.sample);this.neuQuant.buildColormap();this.colorTab=this.neuQuant.getColormap()}if(this.dither){this.ditherPixels(this.dither.replace("-serpentine",""),this.dither.match(/-serpentine/)!==null)}else{this.indexPixels()}this.pixels=null;this.colorDepth=8;this.palSize=7;if(this.transparent!==null){this.transIndex=this.findClosest(this.transparent,true)}};GIFEncoder.prototype.indexPixels=function(imgq){var nPix=this.pixels.length/3;this.indexedPixels=new Uint8Array(nPix);var k=0;for(var j=0;j<nPix;j++){var index=this.findClosestRGB(this.pixels[k++]&255,this.pixels[k++]&255,this.pixels[k++]&255);this.usedEntry[index]=true;this.indexedPixels[j]=index}};GIFEncoder.prototype.ditherPixels=function(kernel,serpentine){var kernels={FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[2/8,1,1]],FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]]};if(!kernel||!kernels[kernel]){throw"Unknown dithering kernel: "+kernel}var ds=kernels[kernel];var index=0,height=this.height,width=this.width,data=this.pixels;var direction=serpentine?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(var y=0;y<height;y++){if(serpentine)direction=direction*-1;for(var x=direction==1?0:width-1,xend=direction==1?width:0;x!==xend;x+=direction){index=y*width+x;var idx=index*3;var r1=data[idx];var g1=data[idx+1];var b1=data[idx+2];idx=this.findClosestRGB(r1,g1,b1);this.usedEntry[idx]=true;this.indexedPixels[index]=idx;idx*=3;var r2=this.colorTab[idx];var g2=this.colorTab[idx+1];var b2=this.colorTab[idx+2];var er=r1-r2;var eg=g1-g2;var eb=b1-b2;for(var i=direction==1?0:ds.length-1,end=direction==1?ds.length:0;i!==end;i+=direction){var x1=ds[i][1];var y1=ds[i][2];if(x1+x>=0&&x1+x<width&&y1+y>=0&&y1+y<height){var d=ds[i][0];idx=index+x1+y1*width;idx*=3;data[idx]=Math.max(0,Math.min(255,data[idx]+er*d));data[idx+1]=Math.max(0,Math.min(255,data[idx+1]+eg*d));data[idx+2]=Math.max(0,Math.min(255,data[idx+2]+eb*d))}}}}};GIFEncoder.prototype.findClosest=function(c,used){return this.findClosestRGB((c&16711680)>>16,(c&65280)>>8,c&255,used)};GIFEncoder.prototype.findClosestRGB=function(r,g,b,used){if(this.colorTab===null)return-1;if(this.neuQuant&&!used){return this.neuQuant.lookupRGB(r,g,b)}var c=b|g<<8|r<<16;var minpos=0;var dmin=256*256*256;var len=this.colorTab.length;for(var i=0,index=0;i<len;index++){var dr=r-(this.colorTab[i++]&255);var dg=g-(this.colorTab[i++]&255);var db=b-(this.colorTab[i++]&255);var d=dr*dr+dg*dg+db*db;if((!used||this.usedEntry[index])&&d<dmin){dmin=d;minpos=index}}return minpos};GIFEncoder.prototype.getImagePixels=function(){var w=this.width;var h=this.height;this.pixels=new Uint8Array(w*h*3);var data=this.image;var srcPos=0;var count=0;for(var i=0;i<h;i++){for(var j=0;j<w;j++){this.pixels[count++]=data[srcPos++];this.pixels[count++]=data[srcPos++];this.pixels[count++]=data[srcPos++];srcPos++}}};GIFEncoder.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33);this.out.writeByte(249);this.out.writeByte(4);var transp,disp;if(this.transparent===null){transp=0;disp=0}else{transp=1;disp=2}if(this.dispose>=0){disp=dispose&7}disp<<=2;this.out.writeByte(0|disp|0|transp);this.writeShort(this.delay);this.out.writeByte(this.transIndex);this.out.writeByte(0)};GIFEncoder.prototype.writeImageDesc=function(){this.out.writeByte(44);this.writeShort(0);this.writeShort(0);this.writeShort(this.width);this.writeShort(this.height);if(this.firstFrame||this.globalPalette){this.out.writeByte(0)}else{this.out.writeByte(128|0|0|0|this.palSize)}};GIFEncoder.prototype.writeLSD=function(){this.writeShort(this.width);this.writeShort(this.height);this.out.writeByte(128|112|0|this.palSize);this.out.writeByte(0);this.out.writeByte(0)};GIFEncoder.prototype.writeNetscapeExt=function(){this.out.writeByte(33);this.out.writeByte(255);this.out.writeByte(11);this.out.writeUTFBytes("NETSCAPE2.0");this.out.writeByte(3);this.out.writeByte(1);this.writeShort(this.repeat);this.out.writeByte(0)};GIFEncoder.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var n=3*256-this.colorTab.length;for(var i=0;i<n;i++)this.out.writeByte(0)};GIFEncoder.prototype.writeShort=function(pValue){this.out.writeByte(pValue&255);this.out.writeByte(pValue>>8&255)};GIFEncoder.prototype.writePixels=function(){var enc=new LZWEncoder(this.width,this.height,this.indexedPixels,this.colorDepth);enc.encode(this.out)};GIFEncoder.prototype.stream=function(){return this.out};module.exports=GIFEncoder},{"./LZWEncoder.js":2,"./TypedNeuQuant.js":3}],2:[function(require,module,exports){var EOF=-1;var BITS=12;var HSIZE=5003;var masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function LZWEncoder(width,height,pixels,colorDepth){var initCodeSize=Math.max(2,colorDepth);var accum=new Uint8Array(256);var htab=new Int32Array(HSIZE);var codetab=new Int32Array(HSIZE);var cur_accum,cur_bits=0;var a_count;var free_ent=0;var maxcode;var clear_flg=false;var g_init_bits,ClearCode,EOFCode;function char_out(c,outs){accum[a_count++]=c;if(a_count>=254)flush_char(outs)}function cl_block(outs){cl_hash(HSIZE);free_ent=ClearCode+2;clear_flg=true;output(ClearCode,outs)}function cl_hash(hsize){for(var i=0;i<hsize;++i)htab[i]=-1}function compress(init_bits,outs){var fcode,c,i,ent,disp,hsize_reg,hshift;g_init_bits=init_bits;clear_flg=false;n_bits=g_init_bits;maxcode=MAXCODE(n_bits);ClearCode=1<<init_bits-1;EOFCode=ClearCode+1;free_ent=ClearCode+2;a_count=0;ent=nextPixel();hshift=0;for(fcode=HSIZE;fcode<65536;fcode*=2)++hshift;hshift=8-hshift;hsize_reg=HSIZE;cl_hash(hsize_reg);output(ClearCode,outs);outer_loop:while((c=nextPixel())!=EOF){fcode=(c<<BITS)+ent;i=c<<hshift^ent;if(htab[i]===fcode){ent=codetab[i];continue}else if(htab[i]>=0){disp=hsize_reg-i;if(i===0)disp=1;do{if((i-=disp)<0)i+=hsize_reg;if(htab[i]===fcode){ent=codetab[i];continue outer_loop}}while(htab[i]>=0)}output(ent,outs);ent=c;if(free_ent<1<<BITS){codetab[i]=free_ent++;htab[i]=fcode}else{cl_block(outs)}}output(ent,outs);output(EOFCode,outs)}function encode(outs){outs.writeByte(initCodeSize);remaining=width*height;curPixel=0;compress(initCodeSize+1,outs);outs.writeByte(0)}function flush_char(outs){if(a_count>0){outs.writeByte(a_count);outs.writeBytes(accum,0,a_count);a_count=0}}function MAXCODE(n_bits){return(1<<n_bits)-1}function nextPixel(){if(remaining===0)return EOF;--remaining;var pix=pixels[curPixel++];return pix&255}function output(code,outs){cur_accum&=masks[cur_bits];if(cur_bits>0)cur_accum|=code<<cur_bits;else cur_accum=code;cur_bits+=n_bits;while(cur_bits>=8){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}if(free_ent>maxcode||clear_flg){if(clear_flg){maxcode=MAXCODE(n_bits=g_init_bits);clear_flg=false}else{++n_bits;if(n_bits==BITS)maxcode=1<<BITS;else maxcode=MAXCODE(n_bits)}}if(code==EOFCode){while(cur_bits>0){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}flush_char(outs)}}this.encode=encode}module.exports=LZWEncoder},{}],3:[function(require,module,exports){var ncycles=100;var netsize=256;var maxnetpos=netsize-1;var netbiasshift=4;var intbiasshift=16;var intbias=1<<intbiasshift;var gammashift=10;var gamma=1<<gammashift;var betashift=10;var beta=intbias>>betashift;var betagamma=intbias<<gammashift-betashift;var initrad=netsize>>3;var radiusbiasshift=6;var radiusbias=1<<radiusbiasshift;var initradius=initrad*radiusbias;var radiusdec=30;var alphabiasshift=10;var initalpha=1<<alphabiasshift;var alphadec;var radbiasshift=8;var radbias=1<<radbiasshift;var alpharadbshift=alphabiasshift+radbiasshift;var alpharadbias=1<<alpharadbshift;var prime1=499;var prime2=491;var prime3=487;var prime4=503;var minpicturebytes=3*prime4;function NeuQuant(pixels,samplefac){var network;var netindex;var bias;var freq;var radpower;function init(){network=[];netindex=new Int32Array(256);bias=new Int32Array(netsize);freq=new Int32Array(netsize);radpower=new Int32Array(netsize>>3);var i,v;for(i=0;i<netsize;i++){v=(i<<netbiasshift+8)/netsize;network[i]=new Float64Array([v,v,v,0]);freq[i]=intbias/netsize;bias[i]=0}}function unbiasnet(){for(var i=0;i<netsize;i++){network[i][0]>>=netbiasshift;network[i][1]>>=netbiasshift;network[i][2]>>=netbiasshift;network[i][3]=i}}function altersingle(alpha,i,b,g,r){network[i][0]-=alpha*(network[i][0]-b)/initalpha;network[i][1]-=alpha*(network[i][1]-g)/initalpha;network[i][2]-=alpha*(network[i][2]-r)/initalpha}function alterneigh(radius,i,b,g,r){var lo=Math.abs(i-radius);var hi=Math.min(i+radius,netsize);var j=i+1;var k=i-1;var m=1;var p,a;while(j<hi||k>lo){a=radpower[m++];if(j<hi){p=network[j++];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}if(k>lo){p=network[k--];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}}}function contest(b,g,r){var bestd=~(1<<31);var bestbiasd=bestd;var bestpos=-1;var bestbiaspos=bestpos;var i,n,dist,biasdist,betafreq;for(i=0;i<netsize;i++){n=network[i];dist=Math.abs(n[0]-b)+Math.abs(n[1]-g)+Math.abs(n[2]-r);if(dist<bestd){bestd=dist;bestpos=i}biasdist=dist-(bias[i]>>intbiasshift-netbiasshift);if(biasdist<bestbiasd){bestbiasd=biasdist;bestbiaspos=i}betafreq=freq[i]>>betashift;freq[i]-=betafreq;bias[i]+=betafreq<<gammashift}freq[bestpos]+=beta;bias[bestpos]-=betagamma;return bestbiaspos}function inxbuild(){var i,j,p,q,smallpos,smallval,previouscol=0,startpos=0;for(i=0;i<netsize;i++){p=network[i];smallpos=i;smallval=p[1];for(j=i+1;j<netsize;j++){q=network[j];if(q[1]<smallval){smallpos=j;smallval=q[1]}}q=network[smallpos];if(i!=smallpos){j=q[0];q[0]=p[0];p[0]=j;j=q[1];q[1]=p[1];p[1]=j;j=q[2];q[2]=p[2];p[2]=j;j=q[3];q[3]=p[3];p[3]=j}if(smallval!=previouscol){netindex[previouscol]=startpos+i>>1;for(j=previouscol+1;j<smallval;j++)netindex[j]=i;previouscol=smallval;startpos=i}}netindex[previouscol]=startpos+maxnetpos>>1;for(j=previouscol+1;j<256;j++)netindex[j]=maxnetpos}function inxsearch(b,g,r){var a,p,dist;var bestd=1e3;var best=-1;var i=netindex[g];var j=i-1;while(i<netsize||j>=0){if(i<netsize){p=network[i];dist=p[1]-g;if(dist>=bestd)i=netsize;else{i++;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}if(j>=0){p=network[j];dist=g-p[1];if(dist>=bestd)j=-1;else{j--;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}}return best}function learn(){var i;var lengthcount=pixels.length;var alphadec=30+(samplefac-1)/3;var samplepixels=lengthcount/(3*samplefac);var delta=~~(samplepixels/ncycles);var alpha=initalpha;var radius=initradius;var rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(i=0;i<rad;i++)radpower[i]=alpha*((rad*rad-i*i)*radbias/(rad*rad));var step;if(lengthcount<minpicturebytes){samplefac=1;step=3}else if(lengthcount%prime1!==0){step=3*prime1}else if(lengthcount%prime2!==0){step=3*prime2}else if(lengthcount%prime3!==0){step=3*prime3}else{step=3*prime4}var b,g,r,j;var pix=0;i=0;while(i<samplepixels){b=(pixels[pix]&255)<<netbiasshift;g=(pixels[pix+1]&255)<<netbiasshift;r=(pixels[pix+2]&255)<<netbiasshift;j=contest(b,g,r);altersingle(alpha,j,b,g,r);if(rad!==0)alterneigh(rad,j,b,g,r);pix+=step;if(pix>=lengthcount)pix-=lengthcount;i++;if(delta===0)delta=1;if(i%delta===0){alpha-=alpha/alphadec;radius-=radius/radiusdec;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(j=0;j<rad;j++)radpower[j]=alpha*((rad*rad-j*j)*radbias/(rad*rad))}}}function buildColormap(){init();learn();unbiasnet();inxbuild()}this.buildColormap=buildColormap;function getColormap(){var map=[];var index=[];for(var i=0;i<netsize;i++)index[network[i][3]]=i;var k=0;for(var l=0;l<netsize;l++){var j=index[l];map[k++]=network[j][0];map[k++]=network[j][1];map[k++]=network[j][2]}return map}this.getColormap=getColormap;this.lookupRGB=inxsearch}module.exports=NeuQuant},{}],4:[function(require,module,exports){var GIFEncoder,renderFrame;GIFEncoder=require("./GIFEncoder.js");renderFrame=function(frame){var encoder,page,stream,transfer;encoder=new GIFEncoder(frame.width,frame.height);if(frame.index===0){encoder.writeHeader()}else{encoder.firstFrame=false}encoder.setTransparent(frame.transparent);encoder.setRepeat(frame.repeat);encoder.setDelay(frame.delay);encoder.setQuality(frame.quality);encoder.setDither(frame.dither);encoder.setGlobalPalette(frame.globalPalette);encoder.addFrame(frame.data);if(frame.last){encoder.finish()}if(frame.globalPalette===true){frame.globalPalette=encoder.getGlobalPalette()}stream=encoder.stream();frame.data=stream.pages;frame.cursor=stream.cursor;frame.pageSize=stream.constructor.pageSize;if(frame.canTransfer){transfer=function(){var i,len,ref,results;ref=frame.data;results=[];for(i=0,len=ref.length;i<len;i++){page=ref[i];results.push(page.buffer)}return results}();return self.postMessage(frame,transfer)}else{return self.postMessage(frame)}};self.onmessage=function(event){return renderFrame(event.data)}},{"./GIFEncoder.js":1}]},{},[4]);
//# sourceMappingURL=gif.worker.js.map
</script>


<pre style="display: none;"><code class="klipse">

(ns my.reagent-examples
  (:require
    [clojure.string :as string]
    [reagent.core :as reagent]
    [reagent.dom.server]
[reagent.ratom]))

(enable-console-print!)
(defn svg-polyline[ps]
(let[[[x0 y0] & ps] ps
init-point (str "M " x0 ", " y0 " ")
seg (fn[[x y]] (str "L " x ", " y " "))]
(reduce #(str %1 (seg %2)) init-point ps)))
(defn draw-polylines[[w h] pss]
          [:svg {:xmlns "http://www.w3.org/2000/svg" :width w :height h}
[:rect {:x 0 :y 0 :width w :height h :fill "white"}]
          [:path {:stroke "black" :stroke-width 1 :fill "none" :d  (reduce str (map svg-polyline pss))}] ])
(defn add [[x0 y0][x1 y1]]
[(+ x0 x1)(+ y0 y1)])
(def make-polylines-transform (comp (partial partial mapv) (partial partial mapv) ))
(defn sin[x]
  (.sin js/Math x))
(defn cos[x]
          (.cos js/Math x))

(def PI
  (.-PI js/Math))
    (def sqrt #(.sqrt js/Math %))

    (defn rotate [a [x y]]
    (let [c (cos a)
          s (sin a)]
    [(- (* c x) (* s y)) (+ (* s x) (* c y))]))
(defn scale [k p]
(mapv (partial * k) p))
(def minus (partial scale -1.))
(def -INF (.-NEGATIVE_INFINITY js/Number))
(def INF (.-POSITIVE_INFINITY js/Number))

    (defn bounding-box[pss]
    (->> pss (reduce into [])(reduce (fn[[[x-min y-min][x-max y-max]][x y]] [[(min x-min x) (min y-min y)][(max x-max x)(max y-max y)]]) [[INF INF][-INF -INF]])))
      (defn make-fitting-transform[[w h] pss]
      (let[[[x-min y-min][x-max y-max]](bounding-box pss)
      s (min (/ w (- x-max x-min)) (/ h (- y-max y-min)))
      center (scale 0.5  (add [x-min y-min] [x-max y-max]))]
      (comp (partial add [(/ w 2) (/ h 2)]) (partial scale s) (partial add (minus center)))))
      (defn draw-fitted-polylines[wh pss]
      (draw-polylines wh ((make-polylines-transform (make-fitting-transform wh pss)) pss)))
(defn make-rotate-around [r a]
  (comp (partial add r)(partial rotate a) (partial add (minus r))))
(def TWO_PI (* 2 PI))
(defn regular-polygon [n]
(vec (take (inc n)(iterate (partial rotate (/ TWO_PI n)) [1. 0]))))
(defn weighted-mean [t [p0 p1]]
(add (scale (- 1 t) p0) (scale t p1)))
(defn str->url [s t]
(let[blob (js/Blob. #js [s] #js {:type t})]
              (.createObjectURL js/URL blob) ))

(def worker-url (let[ gif-worker-src (.-textContent (. js/document (getElementById "gif-js-worker-code")))] 
(str->url gif-worker-src "application/javascript")))

;; bug in Klipse ?
(def test-svg "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"200\" height=\"200\"><rect y=\"0\" fill=\"white\" width=\"200\" x=\"0\" height=\"200\"></rect><path stroke=\"black\" fill=\"none\" stroke-width=\"1\" d=\"M 200, 100 L 50.00000000000002, 186.60254037844388 L 49.999999999999964, 13.397459621556166 L 199.99999999999997, 99.99999999999994 M 200, 100 L 100, 200 L 0, 100.00000000000001 L 99.99999999999999, 0 L 200, 99.99999999999997 M 200, 100 L 130.90169943749476, 195.10565162951536 L 19.098300562505273, 158.77852522924732 L 19.09830056250526, 41.2214747707527 L 130.90169943749473, 4.894348370484636 L 200, 99.99999999999997 M 200, 100 L 150, 186.60254037844385 L 50.00000000000002, 186.60254037844388 L 0, 100.00000000000004 L 49.99999999999996, 13.397459621556166 L 149.99999999999994, 13.397459621556095 L 200, 99.99999999999991 \"></path></svg>")
(def tst-svg "<svg xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\" width=\"400\" height=\"400\"><path stroke=\"black\" fill=\"none\" stroke-width=\"1\" d=\"M 373.2050807568877, 200.00000000000006 L 197.2507130038589, 301.5873015873017 L 197.25071300385883, 98.41269841269852 L 373.20508075688764, 200 M 197.25071300385886, 200.00000000000009 L 109.27352912734447, 250.79365079365087 L 109.27352912734445, 149.2063492063493 L 197.25071300385886, 200.00000000000006 M 109.27352912734447, 200.00000000000009 L 65.28493718908729, 225.39682539682548 L 65.28493718908729, 174.6031746031747 L 109.27352912734447, 200.00000000000006 M 65.28493718908729, 200.00000000000009 L 43.29064121995867, 212.6984126984128 L 43.29064121995867, 187.3015873015874 L 65.28493718908729, 200.00000000000009 M 43.29064121995867, 200.00000000000009 L 32.29349323539438, 206.34920634920644 L 32.29349323539438, 193.65079365079376 L 43.29064121995867, 200.00000000000009 M 32.29349323539438, 200.00000000000009 L 26.79491924311222, 203.17460317460328 L 26.79491924311222, 196.82539682539692 L 32.29349323539438, 200.00000000000009 M 43.29064121995867, 193.65079365079373 L 37.79206722767651, 196.82539682539692 L 37.79206722767651, 190.47619047619057 L 43.29064121995867, 193.65079365079373 M 43.29064121995867, 206.34920634920644 L 37.79206722767651, 209.5238095238096 L 37.79206722767651, 203.17460317460328 L 43.29064121995867, 206.34920634920644 M 65.28493718908729, 187.30158730158738 L 54.287789204522966, 193.65079365079373 L 54.287789204522966, 180.95238095238105 L 65.28493718908729, 187.30158730158738 M 54.287789204522966, 187.30158730158738 L 48.78921521224083, 190.47619047619057 L 48.78921521224083, 184.1269841269842 L 54.287789204522966, 187.30158730158738 M 65.28493718908729, 180.95238095238102 L 59.78636319680513, 184.1269841269842 L 59.78636319680513, 177.77777777777786 L 65.28493718908729, 180.95238095238102 M 65.28493718908729, 193.65079365079373 L 59.78636319680513, 196.82539682539692 L 59.78636319680513, 190.47619047619057 L 65.28493718908729, 193.65079365079373 M 65.28493718908729, 212.6984126984128 L 54.287789204522966, 219.04761904761912 L 54.287789204522966, 206.34920634920644 L 65.28493718908729, 212.69841269841277 M 54.287789204522966, 212.6984126984128 L 48.78921521224083, 215.87301587301596 L 48.78921521224083, 209.5238095238096 L 54.287789204522966, 212.69841269841277 M 65.28493718908729, 206.34920634920644 L 59.78636319680513, 209.5238095238096 L 59.78636319680513, 203.17460317460325 L 65.28493718908729, 206.34920634920644 M 65.28493718908729, 219.04761904761912 L 59.78636319680513, 222.2222222222223 L 59.78636319680513, 215.87301587301596 L 65.28493718908729, 219.04761904761912 M 109.27352912734445, 174.60317460317466 L 87.27923315821587, 187.30158730158738 L 87.27923315821585, 161.90476190476198 L 109.27352912734445, 174.60317460317466 M 87.27923315821585, 174.6031746031747 L 76.28208517365155, 180.95238095238102 L 76.28208517365155, 168.25396825396834 L 87.27923315821585, 174.60317460317466 M 76.28208517365155, 174.6031746031747 L 70.78351118136939, 177.77777777777786 L 70.78351118136939, 171.4285714285715 L 76.28208517365155, 174.60317460317466 M 87.27923315821585, 168.25396825396834 L 81.7806591659337, 171.4285714285715 L 81.7806591659337, 165.07936507936515 L 87.27923315821585, 168.2539682539683 M 87.27923315821587, 180.95238095238102 L 81.78065916593373, 184.1269841269842 L 81.78065916593373, 177.77777777777786 L 87.27923315821587, 180.95238095238102 M 109.27352912734445, 161.90476190476198 L 98.27638114278015, 168.2539682539683 L 98.27638114278015, 155.55555555555563 L 109.27352912734445, 161.90476190476198 M 98.27638114278015, 161.90476190476198 L 92.77780715049799, 165.07936507936515 L 92.77780715049799, 158.7301587301588 L 98.27638114278015, 161.90476190476198 M 109.27352912734445, 155.55555555555563 L 103.7749551350623, 158.7301587301588 L 103.77495513506227, 152.38095238095244 L 109.27352912734442, 155.55555555555563 M 109.27352912734445, 168.2539682539683 L 103.7749551350623, 171.4285714285715 L 103.7749551350623, 165.07936507936515 L 109.27352912734445, 168.2539682539683 M 109.27352912734447, 187.30158730158738 L 98.27638114278017, 193.65079365079373 L 98.27638114278017, 180.95238095238102 L 109.27352912734447, 187.30158730158738 M 98.27638114278017, 187.30158730158738 L 92.77780715049802, 190.47619047619054 L 92.77780715049802, 184.1269841269842 L 98.27638114278017, 187.30158730158738 M 109.27352912734447, 180.95238095238102 L 103.77495513506233, 184.12698412698418 L 103.7749551350623, 177.77777777777786 L 109.27352912734447, 180.95238095238102 M 109.27352912734447, 193.65079365079373 L 103.77495513506233, 196.8253968253969 L 103.77495513506233, 190.47619047619054 L 109.27352912734447, 193.65079365079373 M 109.27352912734447, 225.39682539682548 L 87.2792331582159, 238.0952380952382 L 87.27923315821587, 212.69841269841277 L 109.27352912734447, 225.39682539682548 M 87.27923315821587, 225.39682539682548 L 76.28208517365158, 231.74603174603183 L 76.28208517365158, 219.04761904761912 L 87.27923315821587, 225.39682539682548 M 76.28208517365158, 225.39682539682548 L 70.78351118136942, 228.57142857142864 L 70.78351118136942, 222.2222222222223 L 76.28208517365158, 225.39682539682548 M 87.27923315821587, 219.04761904761912 L 81.78065916593373, 222.22222222222229 L 81.78065916593373, 215.87301587301596 L 87.27923315821587, 219.04761904761912 M 87.2792331582159, 231.7460317460318 L 81.78065916593376, 234.920634920635 L 81.78065916593376, 228.57142857142864 L 87.2792331582159, 231.7460317460318 M 109.27352912734447, 212.69841269841277 L 98.27638114278017, 219.04761904761912 L 98.27638114278017, 206.3492063492064 L 109.27352912734447, 212.69841269841277 M 98.27638114278017, 212.69841269841277 L 92.77780715049802, 215.87301587301593 L 92.77780715049802, 209.5238095238096 L 98.27638114278017, 212.69841269841277 M 109.27352912734447, 206.3492063492064 L 103.77495513506233, 209.5238095238096 L 103.77495513506233, 203.17460317460325 L 109.27352912734447, 206.3492063492064 M 109.27352912734447, 219.04761904761912 L 103.77495513506233, 222.22222222222229 L 103.77495513506233, 215.87301587301593 L 109.27352912734447, 219.04761904761912 M 109.2735291273445, 238.09523809523816 L 98.2763811427802, 244.4444444444445 L 98.2763811427802, 231.7460317460318 L 109.2735291273445, 238.09523809523816 M 98.2763811427802, 238.09523809523816 L 92.77780715049805, 241.26984126984135 L 92.77780715049805, 234.920634920635 L 98.2763811427802, 238.09523809523816 M 109.2735291273445, 231.7460317460318 L 103.77495513506236, 234.920634920635 L 103.77495513506236, 228.57142857142864 L 109.2735291273445, 231.7460317460318 M 109.2735291273445, 244.4444444444445 L 103.77495513506236, 247.6190476190477 L 103.77495513506236, 241.26984126984132 L 109.2735291273445, 244.4444444444445 M 197.25071300385883, 149.20634920634927 L 153.26212106560166, 174.60317460317466 L 153.2621210656016, 123.80952380952388 L 197.25071300385883, 149.20634920634924 M 153.26212106560163, 149.20634920634927 L 131.26782509647302, 161.90476190476195 L 131.26782509647302, 136.50793650793656 L 153.26212106560163, 149.20634920634927 M 131.26782509647302, 149.20634920634927 L 120.27067711190873, 155.5555555555556 L 120.27067711190873, 142.85714285714292 L 131.26782509647302, 149.20634920634927 M 120.27067711190873, 149.20634920634927 L 114.77210311962658, 152.38095238095244 L 114.77210311962658, 146.03174603174608 L 120.27067711190873, 149.20634920634927 M 131.26782509647302, 142.85714285714292 L 125.76925110419087, 146.03174603174608 L 125.76925110419087, 139.68253968253975 L 131.26782509647302, 142.85714285714292 M 131.26782509647302, 155.5555555555556 L 125.7692511041909, 158.7301587301588 L 125.76925110419087, 152.38095238095244 L 131.26782509647302, 155.5555555555556 M 153.2621210656016, 136.50793650793656 L 142.2649730810373, 142.85714285714292 L 142.2649730810373, 130.15873015873024 L 153.2621210656016, 136.50793650793656 M 142.2649730810373, 136.50793650793656 L 136.76639908875518, 139.68253968253975 L 136.76639908875518, 133.33333333333337 L 142.2649730810373, 136.50793650793656 M 153.2621210656016, 130.15873015873024 L 147.76354707331947, 133.33333333333337 L 147.76354707331947, 126.98412698412703 L 153.2621210656016, 130.1587301587302 M 153.2621210656016, 142.85714285714292 L 147.76354707331947, 146.03174603174608 L 147.76354707331947, 139.68253968253975 L 153.2621210656016, 142.85714285714292 M 153.26212106560166, 161.90476190476195 L 142.26497308103734, 168.2539682539683 L 142.26497308103734, 155.5555555555556 L 153.26212106560166, 161.90476190476195 M 142.26497308103734, 161.90476190476195 L 136.7663990887552, 165.07936507936515 L 136.7663990887552, 158.7301587301588 L 142.26497308103734, 161.90476190476195 M 153.26212106560163, 155.5555555555556 L 147.7635470733195, 158.7301587301588 L 147.7635470733195, 152.38095238095244 L 153.26212106560163, 155.5555555555556 M 153.26212106560166, 168.2539682539683 L 147.7635470733195, 171.42857142857147 L 147.7635470733195, 165.07936507936512 L 153.26212106560166, 168.2539682539683 M 197.25071300385883, 123.80952380952387 L 175.25641703473022, 136.50793650793656 L 175.25641703473022, 111.11111111111116 L 197.2507130038588, 123.80952380952385 M 175.25641703473022, 123.80952380952387 L 164.25926905016593, 130.1587301587302 L 164.2592690501659, 117.46031746031751 L 175.25641703473022, 123.80952380952385 M 164.25926905016593, 123.80952380952387 L 158.76069505788377, 126.98412698412703 L 158.76069505788377, 120.63492063492068 L 164.25926905016593, 123.80952380952387 M 175.25641703473022, 117.46031746031751 L 169.75784304244806, 120.63492063492068 L 169.75784304244806, 114.28571428571433 L 175.25641703473022, 117.4603174603175 M 175.25641703473022, 130.1587301587302 L 169.7578430424481, 133.33333333333337 L 169.7578430424481, 126.98412698412703 L 175.25641703473022, 130.1587301587302 M 197.2507130038588, 111.11111111111116 L 186.2535650192945, 117.4603174603175 L 186.25356501929448, 104.7619047619048 L 197.2507130038588, 111.11111111111116 M 186.2535650192945, 111.11111111111116 L 180.75499102701235, 114.28571428571432 L 180.75499102701235, 107.93650793650797 L 186.2535650192945, 111.11111111111116 M 197.2507130038588, 104.7619047619048 L 191.75213901157665, 107.93650793650797 L 191.75213901157665, 101.58730158730164 L 197.2507130038588, 104.7619047619048 M 197.2507130038588, 117.4603174603175 L 191.75213901157665, 120.63492063492068 L 191.75213901157665, 114.28571428571432 L 197.2507130038588, 117.4603174603175 M 197.25071300385883, 136.50793650793653 L 186.2535650192945, 142.8571428571429 L 186.2535650192945, 130.1587301587302 L 197.25071300385883, 136.50793650793653 M 186.2535650192945, 136.50793650793656 L 180.75499102701238, 139.68253968253973 L 180.75499102701238, 133.33333333333337 L 186.2535650192945, 136.50793650793653 M 197.25071300385883, 130.1587301587302 L 191.75213901157667, 133.33333333333337 L 191.75213901157667, 126.98412698412702 L 197.25071300385883, 130.1587301587302 M 197.25071300385883, 142.8571428571429 L 191.75213901157667, 146.03174603174608 L 191.75213901157667, 139.68253968253973 L 197.25071300385883, 142.8571428571429 M 197.25071300385883, 174.60317460317464 L 175.25641703473025, 187.30158730158735 L 175.25641703473025, 161.90476190476195 L 197.25071300385883, 174.60317460317464 M 175.25641703473025, 174.60317460317466 L 164.25926905016595, 180.95238095238102 L 164.25926905016595, 168.2539682539683 L 175.25641703473025, 174.60317460317464 M 164.25926905016595, 174.60317460317466 L 158.7606950578838, 177.77777777777783 L 158.7606950578838, 171.42857142857147 L 164.25926905016595, 174.60317460317464 M 175.25641703473025, 168.2539682539683 L 169.7578430424481, 171.42857142857147 L 169.7578430424481, 165.07936507936512 L 175.25641703473025, 168.2539682539683 M 175.25641703473025, 180.952380952381 L 169.7578430424481, 184.12698412698418 L 169.7578430424481, 177.77777777777783 L 175.25641703473025, 180.952380952381 M 197.25071300385883, 161.90476190476195 L 186.25356501929454, 168.2539682539683 L 186.25356501929454, 155.5555555555556 L 197.25071300385883, 161.90476190476195 M 186.25356501929454, 161.90476190476195 L 180.7549910270124, 165.07936507936512 L 180.7549910270124, 158.7301587301588 L 186.25356501929454, 161.90476190476195 M 197.25071300385883, 155.5555555555556 L 191.75213901157667, 158.7301587301588 L 191.75213901157667, 152.3809523809524 L 197.25071300385883, 155.5555555555556 M 197.25071300385883, 168.2539682539683 L 191.7521390115767, 171.42857142857147 L 191.7521390115767, 165.07936507936512 L 197.25071300385883, 168.25396825396828 M 197.25071300385886, 187.30158730158735 L 186.25356501929457, 193.6507936507937 L 186.25356501929457, 180.952380952381 L 197.25071300385886, 187.30158730158735 M 186.25356501929457, 187.30158730158735 L 180.7549910270124, 190.47619047619054 L 180.7549910270124, 184.12698412698418 L 186.25356501929457, 187.30158730158735 M 197.25071300385883, 180.952380952381 L 191.7521390115767, 184.12698412698415 L 191.7521390115767, 177.77777777777783 L 197.25071300385883, 180.952380952381 M 197.25071300385886, 193.6507936507937 L 191.7521390115767, 196.82539682539687 L 191.7521390115767, 190.4761904761905 L 197.25071300385886, 193.65079365079367 M 197.2507130038589, 250.79365079365084 L 153.26212106560172, 276.19047619047626 L 153.2621210656017, 225.39682539682548 L 197.2507130038589, 250.79365079365084 M 153.2621210656017, 250.79365079365087 L 131.2678250964731, 263.49206349206355 L 131.2678250964731, 238.09523809523816 L 153.2621210656017, 250.79365079365084 M 131.2678250964731, 250.79365079365087 L 120.2706771119088, 257.1428571428572 L 120.2706771119088, 244.4444444444445 L 131.2678250964731, 250.79365079365084 M 120.2706771119088, 250.79365079365087 L 114.77210311962665, 253.96825396825403 L 114.77210311962665, 247.61904761904768 L 120.2706771119088, 250.79365079365087 M 131.2678250964731, 244.4444444444445 L 125.76925110419096, 247.61904761904768 L 125.76925110419096, 241.26984126984132 L 131.2678250964731, 244.4444444444445 M 131.2678250964731, 257.1428571428572 L 125.76925110419097, 260.31746031746036 L 125.76925110419096, 253.96825396825403 L 131.2678250964731, 257.1428571428572 M 153.2621210656017, 238.09523809523816 L 142.2649730810374, 244.4444444444445 L 142.2649730810374, 231.7460317460318 L 153.2621210656017, 238.09523809523813 M 142.2649730810374, 238.09523809523816 L 136.76639908875524, 241.26984126984132 L 136.76639908875524, 234.92063492063497 L 142.2649730810374, 238.09523809523816 M 153.2621210656017, 231.7460317460318 L 147.76354707331956, 234.92063492063497 L 147.76354707331953, 228.5714285714286 L 153.2621210656017, 231.7460317460318 M 153.2621210656017, 244.4444444444445 L 147.76354707331956, 247.61904761904768 L 147.76354707331956, 241.26984126984132 L 153.2621210656017, 244.4444444444445 M 153.26212106560172, 263.49206349206355 L 142.2649730810374, 269.8412698412699 L 142.2649730810374, 257.1428571428572 L 153.26212106560172, 263.49206349206355 M 142.2649730810374, 263.49206349206355 L 136.7663990887553, 266.66666666666674 L 136.7663990887553, 260.31746031746036 L 142.2649730810374, 263.49206349206355 M 153.26212106560172, 257.1428571428572 L 147.76354707331956, 260.31746031746036 L 147.76354707331956, 253.96825396825403 L 153.26212106560172, 257.1428571428572 M 153.26212106560172, 269.8412698412699 L 147.7635470733196, 273.01587301587307 L 147.7635470733196, 266.66666666666674 L 153.26212106560172, 269.8412698412699 M 197.2507130038589, 225.39682539682545 L 175.25641703473028, 238.09523809523813 L 175.25641703473028, 212.69841269841277 L 197.2507130038589, 225.39682539682545 M 175.25641703473028, 225.39682539682545 L 164.25926905016598, 231.7460317460318 L 164.25926905016598, 219.0476190476191 L 175.25641703473028, 225.39682539682545 M 164.25926905016598, 225.39682539682545 L 158.76069505788382, 228.5714285714286 L 158.76069505788382, 222.22222222222229 L 164.25926905016598, 225.39682539682545 M 175.25641703473028, 219.0476190476191 L 169.75784304244814, 222.22222222222229 L 169.75784304244812, 215.87301587301593 L 175.25641703473028, 219.0476190476191 M 175.25641703473028, 231.7460317460318 L 169.75784304244814, 234.92063492063497 L 169.75784304244814, 228.5714285714286 L 175.25641703473028, 231.7460317460318 M 197.25071300385886, 212.69841269841274 L 186.25356501929457, 219.0476190476191 L 186.25356501929457, 206.34920634920638 L 197.25071300385886, 212.69841269841274 M 186.25356501929457, 212.69841269841274 L 180.7549910270124, 215.8730158730159 L 180.7549910270124, 209.52380952380958 L 186.25356501929457, 212.69841269841274 M 197.25071300385886, 206.34920634920638 L 191.75213901157673, 209.52380952380958 L 191.75213901157673, 203.17460317460322 L 197.25071300385886, 206.34920634920638 M 197.25071300385886, 219.0476190476191 L 191.75213901157673, 222.22222222222226 L 191.75213901157673, 215.8730158730159 L 197.25071300385886, 219.0476190476191 M 197.2507130038589, 238.09523809523813 L 186.2535650192946, 244.44444444444449 L 186.2535650192946, 231.7460317460318 L 197.2507130038589, 238.09523809523813 M 186.2535650192946, 238.09523809523813 L 180.75499102701244, 241.26984126984132 L 180.75499102701244, 234.92063492063497 L 186.2535650192946, 238.09523809523813 M 197.2507130038589, 231.74603174603178 L 191.75213901157673, 234.92063492063497 L 191.75213901157673, 228.5714285714286 L 197.2507130038589, 231.74603174603178 M 197.2507130038589, 244.44444444444449 L 191.75213901157676, 247.61904761904765 L 191.75213901157676, 241.26984126984132 L 197.2507130038589, 244.44444444444449 M 197.25071300385892, 276.19047619047626 L 175.25641703473033, 288.8888888888889 L 175.25641703473033, 263.49206349206355 L 197.25071300385892, 276.19047619047626 M 175.25641703473033, 276.19047619047626 L 164.25926905016604, 282.5396825396826 L 164.25926905016604, 269.8412698412699 L 175.25641703473033, 276.19047619047626 M 164.25926905016604, 276.19047619047626 L 158.76069505788388, 279.3650793650794 L 158.76069505788388, 273.01587301587307 L 164.25926905016604, 276.19047619047626 M 175.25641703473033, 269.8412698412699 L 169.75784304244817, 273.01587301587307 L 169.75784304244817, 266.66666666666674 L 175.2564170347303, 269.8412698412699 M 175.25641703473033, 282.5396825396826 L 169.75784304244817, 285.7142857142858 L 169.75784304244817, 279.3650793650794 L 175.25641703473033, 282.5396825396826 M 197.25071300385892, 263.49206349206355 L 186.25356501929463, 269.8412698412699 L 186.25356501929463, 257.1428571428572 L 197.25071300385892, 263.49206349206355 M 186.25356501929463, 263.49206349206355 L 180.75499102701247, 266.66666666666674 L 180.75499102701247, 260.31746031746036 L 186.25356501929463, 263.49206349206355 M 197.2507130038589, 257.14285714285717 L 191.75213901157676, 260.31746031746036 L 191.75213901157676, 253.968253968254 L 197.2507130038589, 257.14285714285717 M 197.25071300385892, 269.8412698412699 L 191.7521390115768, 273.01587301587307 L 191.75213901157676, 266.66666666666674 L 197.25071300385892, 269.8412698412699 M 197.25071300385892, 288.8888888888889 L 186.25356501929463, 295.2380952380953 L 186.25356501929463, 282.5396825396826 L 197.25071300385892, 288.8888888888889 M 186.25356501929463, 288.8888888888889 L 180.75499102701247, 292.0634920634921 L 180.75499102701247, 285.7142857142858 L 186.25356501929463, 288.8888888888889 M 197.25071300385892, 282.5396825396826 L 191.7521390115768, 285.7142857142858 L 191.7521390115768, 279.3650793650794 L 197.25071300385892, 282.5396825396826 M 197.25071300385892, 295.2380952380953 L 191.7521390115768, 298.41269841269843 L 191.7521390115768, 292.0634920634921 L 197.25071300385892, 295.2380952380953 M 373.2050807568876, 98.41269841269843 L 285.22789688037324, 149.20634920634922 L 285.2278968803732, 47.61904761904768 L 373.2050807568876, 98.41269841269839 M 285.2278968803732, 98.41269841269845 L 241.239304942116, 123.80952380952384 L 241.23930494211598, 73.01587301587304 L 285.2278968803732, 98.41269841269842 M 241.239304942116, 98.41269841269845 L 219.2450089729874, 111.11111111111114 L 219.2450089729874, 85.71428571428575 L 241.239304942116, 98.41269841269843 M 219.2450089729874, 98.41269841269845 L 208.2478609884231, 104.7619047619048 L 208.2478609884231, 92.06349206349209 L 219.2450089729874, 98.41269841269845 M 208.2478609884231, 98.41269841269845 L 202.74928699614094, 101.58730158730162 L 202.74928699614094, 95.23809523809528 L 208.2478609884231, 98.41269841269845 M 219.2450089729874, 92.06349206349209 L 213.74643498070523, 95.23809523809527 L 213.74643498070523, 88.88888888888893 L 219.2450089729874, 92.06349206349209 M 219.2450089729874, 104.76190476190479 L 213.74643498070523, 107.93650793650797 L 213.74643498070523, 101.58730158730162 L 219.2450089729874, 104.76190476190479 M 241.23930494211598, 85.71428571428574 L 230.24215695755169, 92.06349206349209 L 230.24215695755169, 79.3650793650794 L 241.23930494211598, 85.71428571428574 M 230.24215695755169, 85.71428571428574 L 224.74358296526952, 88.88888888888891 L 224.74358296526952, 82.53968253968256 L 230.24215695755169, 85.71428571428574 M 241.23930494211598, 79.3650793650794 L 235.74073094983385, 82.53968253968256 L 235.74073094983385, 76.19047619047619 L 241.23930494211598, 79.3650793650794 M 241.239304942116, 92.06349206349209 L 235.74073094983385, 95.23809523809527 L 235.74073094983385, 88.88888888888891 L 241.239304942116, 92.06349206349208 M 241.239304942116, 111.11111111111114 L 230.2421569575517, 117.46031746031748 L 230.24215695755169, 104.76190476190479 L 241.239304942116, 111.11111111111113 M 230.24215695755169, 111.11111111111114 L 224.74358296526955, 114.2857142857143 L 224.74358296526955, 107.93650793650797 L 230.24215695755169, 111.11111111111114 M 241.239304942116, 104.76190476190479 L 235.74073094983385, 107.93650793650797 L 235.74073094983385, 101.58730158730162 L 241.239304942116, 104.76190476190479 M 241.239304942116, 117.46031746031748 L 235.74073094983385, 120.63492063492066 L 235.74073094983385, 114.2857142857143 L 241.239304942116, 117.46031746031748 M 285.2278968803732, 73.01587301587304 L 263.2336009112446, 85.71428571428572 L 263.2336009112446, 60.31746031746036 L 285.2278968803732, 73.01587301587304 M 263.2336009112446, 73.01587301587304 L 252.23645292668027, 79.3650793650794 L 252.23645292668027, 66.66666666666666 L 263.2336009112446, 73.01587301587304 M 252.23645292668027, 73.01587301587304 L 246.7378789343981, 76.19047619047619 L 246.7378789343981, 69.84126984126988 L 252.23645292668027, 73.01587301587304 M 263.2336009112446, 66.66666666666666 L 257.73502691896243, 69.84126984126988 L 257.73502691896243, 63.49206349206352 L 263.2336009112446, 66.66666666666666 M 263.2336009112446, 79.3650793650794 L 257.73502691896243, 82.53968253968256 L 257.73502691896243, 76.19047619047619 L 263.2336009112446, 79.3650793650794 M 285.2278968803732, 60.31746031746036 L 274.23074889580886, 66.66666666666666 L 274.23074889580886, 53.968253968253975 L 285.2278968803732, 60.3174603174603 M 274.23074889580886, 60.31746031746036 L 268.7321749035267, 63.49206349206352 L 268.7321749035267, 57.14285714285714 L 274.23074889580886, 60.3174603174603 M 285.2278968803732, 53.968253968253975 L 279.729322888091, 57.14285714285714 L 279.729322888091, 50.793650793650784 L 285.2278968803731, 53.968253968253975 M 285.2278968803732, 66.66666666666666 L 279.729322888091, 69.84126984126982 L 279.729322888091, 63.49206349206352 L 285.2278968803732, 66.66666666666666 M 285.2278968803732, 85.71428571428572 L 274.2307488958089, 92.06349206349208 L 274.2307488958089, 79.3650793650794 L 285.2278968803732, 85.71428571428572 M 274.2307488958089, 85.71428571428572 L 268.7321749035267, 88.88888888888891 L 268.7321749035267, 82.53968253968256 L 274.2307488958089, 85.71428571428572 M 285.2278968803732, 79.36507936507935 L 279.729322888091, 82.53968253968256 L 279.729322888091, 76.19047619047619 L 285.2278968803732, 79.36507936507935 M 285.2278968803732, 92.06349206349208 L 279.729322888091, 95.23809523809526 L 279.729322888091, 88.8888888888889 L 285.2278968803732, 92.06349206349206 M 285.22789688037324, 123.80952380952382 L 263.2336009112446, 136.50793650793653 L 263.2336009112446, 111.11111111111114 L 285.22789688037324, 123.80952380952382 M 263.2336009112446, 123.80952380952384 L 252.2364529266803, 130.15873015873018 L 252.2364529266803, 117.46031746031748 L 263.2336009112446, 123.80952380952382 M 252.2364529266803, 123.80952380952384 L 246.73787893439817, 126.984126984127 L 246.73787893439817, 120.63492063492066 L 252.2364529266803, 123.80952380952382 M 263.2336009112446, 117.46031746031748 L 257.73502691896243, 120.63492063492065 L 257.73502691896243, 114.2857142857143 L 263.2336009112446, 117.46031746031748 M 263.2336009112446, 130.15873015873018 L 257.7350269189625, 133.33333333333334 L 257.7350269189625, 126.984126984127 L 263.2336009112446, 130.15873015873018 M 285.2278968803732, 111.11111111111113 L 274.2307488958089, 117.46031746031748 L 274.2307488958089, 104.76190476190477 L 285.2278968803732, 111.11111111111111 M 274.2307488958089, 111.11111111111113 L 268.73217490352675, 114.2857142857143 L 268.73217490352675, 107.93650793650797 L 274.2307488958089, 111.11111111111113 M 285.2278968803732, 104.76190476190477 L 279.729322888091, 107.93650793650795 L 279.729322888091, 101.58730158730161 L 285.2278968803732, 104.76190476190477 M 285.22789688037324, 117.46031746031747 L 279.7293228880911, 120.63492063492065 L 279.7293228880911, 114.2857142857143 L 285.22789688037324, 117.46031746031747 M 285.22789688037324, 136.50793650793653 L 274.2307488958089, 142.8571428571429 L 274.2307488958089, 130.15873015873018 L 285.22789688037324, 136.5079365079365 M 274.2307488958089, 136.50793650793653 L 268.73217490352675, 139.6825396825397 L 268.73217490352675, 133.33333333333334 L 274.2307488958089, 136.50793650793653 M 285.22789688037324, 130.15873015873018 L 279.7293228880911, 133.33333333333334 L 279.7293228880911, 126.984126984127 L 285.22789688037324, 130.15873015873018 M 285.22789688037324, 142.85714285714286 L 279.7293228880911, 146.03174603174605 L 279.7293228880911, 139.6825396825397 L 285.22789688037324, 142.85714285714286 M 373.2050807568876, 47.61904761904762 L 329.2164888186304, 73.01587301587304 L 329.21648881863035, 22.2222222222222 L 373.2050807568876, 47.61904761904762 M 329.2164888186304, 47.61904761904762 L 307.22219284950177, 60.3174603174603 L 307.22219284950177, 34.92063492063494 L 329.2164888186304, 47.61904761904762 M 307.22219284950177, 47.61904761904762 L 296.22504486493744, 53.968253968253975 L 296.22504486493744, 41.269841269841265 L 307.22219284950177, 47.61904761904762 M 296.22504486493744, 47.61904761904762 L 290.7264708726553, 50.793650793650784 L 290.7264708726553, 44.44444444444446 L 296.22504486493744, 47.61904761904762 M 307.22219284950177, 41.269841269841265 L 301.7236188572196, 44.44444444444446 L 301.7236188572196, 38.0952380952381 L 307.22219284950177, 41.269841269841265 M 307.22219284950177, 53.968253968253975 L 301.7236188572196, 57.14285714285714 L 301.7236188572196, 50.793650793650784 L 307.22219284950177, 53.968253968253975 M 329.21648881863035, 34.92063492063494 L 318.21934083406603, 41.269841269841265 L 318.21934083406603, 28.571428571428584 L 329.21648881863035, 34.92063492063488 M 318.21934083406603, 34.92063492063494 L 312.72076684178387, 38.0952380952381 L 312.72076684178387, 31.74603174603172 L 318.21934083406603, 34.92063492063488 M 329.21648881863035, 28.571428571428584 L 323.7179148263482, 31.74603174603172 L 323.7179148263482, 25.396825396825363 L 329.21648881863035, 28.571428571428584 M 329.21648881863035, 41.269841269841265 L 323.7179148263482, 44.44444444444446 L 323.7179148263482, 38.0952380952381 L 329.21648881863035, 41.269841269841265 M 329.2164888186304, 60.3174603174603 L 318.2193408340661, 66.66666666666666 L 318.2193408340661, 53.968253968253975 L 329.2164888186304, 60.3174603174603 M 318.2193408340661, 60.3174603174603 L 312.7207668417839, 63.49206349206352 L 312.7207668417839, 57.14285714285714 L 318.2193408340661, 60.3174603174603 M 329.2164888186304, 53.968253968253975 L 323.7179148263482, 57.14285714285714 L 323.7179148263482, 50.793650793650784 L 329.2164888186304, 53.96825396825395 M 329.2164888186304, 66.66666666666666 L 323.7179148263482, 69.84126984126982 L 323.7179148263482, 63.49206349206352 L 329.2164888186304, 66.66666666666666 M 373.2050807568876, 22.2222222222222 L 351.21078478775894, 34.92063492063488 L 351.21078478775894, 9.523809523809518 L 373.2050807568875, 22.2222222222222 M 351.21078478775894, 22.2222222222222 L 340.2136368031946, 28.571428571428584 L 340.2136368031946, 15.873015873015845 L 351.21078478775894, 22.2222222222222 M 340.2136368031946, 22.2222222222222 L 334.7150628109125, 25.396825396825363 L 334.7150628109125, 19.047619047619037 L 340.2136368031946, 22.2222222222222 M 351.21078478775894, 15.873015873015845 L 345.7122107954768, 19.047619047619037 L 345.7122107954768, 12.698412698412682 L 351.21078478775894, 15.873015873015845 M 351.21078478775894, 28.571428571428584 L 345.7122107954768, 31.74603174603172 L 345.7122107954768, 25.396825396825363 L 351.21078478775894, 28.571428571428584 M 373.2050807568875, 9.523809523809518 L 362.2079327723232, 15.873015873015845 L 362.2079327723232, 3.1746031746031633 L 373.2050807568875, 9.523809523809518 M 362.2079327723232, 9.523809523809518 L 356.70935878004104, 12.698412698412682 L 356.70935878004104, 6.349206349206327 L 362.2079327723232, 9.523809523809518 M 373.2050807568875, 3.1746031746031633 L 367.70650676460536, 6.349206349206327 L 367.70650676460536, 0 L 373.2050807568875, 3.1746031746031633 M 373.2050807568875, 15.873015873015845 L 367.70650676460536, 19.047619047619037 L 367.70650676460536, 12.698412698412682 L 373.2050807568875, 15.873015873015845 M 373.2050807568876, 34.92063492063488 L 362.20793277232326, 41.269841269841265 L 362.20793277232326, 28.571428571428584 L 373.2050807568876, 34.92063492063488 M 362.20793277232326, 34.92063492063488 L 356.7093587800411, 38.0952380952381 L 356.7093587800411, 31.74603174603172 L 362.20793277232326, 34.92063492063488 M 373.2050807568876, 28.571428571428584 L 367.70650676460536, 31.74603174603172 L 367.70650676460536, 25.396825396825363 L 373.2050807568876, 28.571428571428584 M 373.2050807568876, 41.269841269841265 L 367.70650676460536, 44.4444444444444 L 367.70650676460536, 38.0952380952381 L 373.2050807568876, 41.269841269841265 M 373.2050807568876, 73.01587301587298 L 351.21078478775894, 85.71428571428571 L 351.21078478775894, 60.3174603174603 L 373.2050807568876, 73.01587301587298 M 351.21078478775894, 73.01587301587304 L 340.2136368031947, 79.36507936507935 L 340.2136368031947, 66.66666666666666 L 351.21078478775894, 73.01587301587298 M 340.2136368031947, 73.01587301587304 L 334.7150628109125, 76.19047619047619 L 334.7150628109125, 69.84126984126982 L 340.2136368031947, 73.01587301587298 M 351.21078478775894, 66.66666666666666 L 345.71221079547684, 69.84126984126982 L 345.71221079547684, 63.492063492063465 L 351.21078478775894, 66.66666666666666 M 351.21078478775894, 79.36507936507935 L 345.71221079547684, 82.5396825396825 L 345.71221079547684, 76.19047619047619 L 351.21078478775894, 79.36507936507935 M 373.2050807568876, 60.3174603174603 L 362.20793277232326, 66.66666666666666 L 362.20793277232326, 53.96825396825395 L 373.2050807568876, 60.3174603174603 M 362.20793277232326, 60.3174603174603 L 356.70935878004116, 63.492063492063465 L 356.70935878004116, 57.14285714285714 L 362.20793277232326, 60.3174603174603 M 373.2050807568876, 53.96825396825395 L 367.7065067646054, 57.14285714285714 L 367.7065067646054, 50.793650793650784 L 373.2050807568876, 53.96825396825395 M 373.2050807568876, 66.66666666666666 L 367.7065067646054, 69.84126984126982 L 367.7065067646054, 63.492063492063465 L 373.2050807568876, 66.66666666666666 M 373.2050807568876, 85.71428571428571 L 362.20793277232326, 92.06349206349205 L 362.20793277232326, 79.36507936507935 L 373.2050807568876, 85.71428571428571 M 362.20793277232326, 85.71428571428571 L 356.70935878004116, 88.88888888888889 L 356.70935878004116, 82.5396825396825 L 362.20793277232326, 85.71428571428571 M 373.2050807568876, 79.36507936507935 L 367.7065067646054, 82.5396825396825 L 367.7065067646054, 76.19047619047619 L 373.2050807568876, 79.36507936507935 M 373.2050807568876, 92.06349206349205 L 367.7065067646054, 95.23809523809523 L 367.7065067646054, 88.88888888888887 L 373.2050807568876, 92.06349206349205 M 373.2050807568876, 149.20634920634922 L 329.2164888186304, 174.6031746031746 L 329.2164888186304, 123.80952380952382 L 373.2050807568876, 149.2063492063492 M 329.2164888186304, 149.20634920634922 L 307.2221928495018, 161.90476190476193 L 307.2221928495018, 136.5079365079365 L 329.2164888186304, 149.20634920634922 M 307.2221928495018, 149.20634920634922 L 296.2250448649375, 155.55555555555557 L 296.2250448649375, 142.85714285714286 L 307.2221928495018, 149.20634920634922 M 296.2250448649375, 149.20634920634922 L 290.72647087265534, 152.3809523809524 L 290.72647087265534, 146.03174603174602 L 296.2250448649375, 149.20634920634922 M 307.2221928495018, 142.85714285714286 L 301.72361885721966, 146.03174603174602 L 301.72361885721966, 139.6825396825397 L 307.2221928495018, 142.85714285714286 M 307.2221928495018, 155.55555555555557 L 301.72361885721966, 158.73015873015873 L 301.72361885721966, 152.38095238095238 L 307.2221928495018, 155.55555555555554 M 329.2164888186304, 136.5079365079365 L 318.2193408340661, 142.85714285714286 L 318.2193408340661, 130.15873015873018 L 329.2164888186304, 136.5079365079365 M 318.2193408340661, 136.5079365079365 L 312.720766841784, 139.6825396825397 L 312.720766841784, 133.33333333333331 L 318.2193408340661, 136.5079365079365 M 329.2164888186304, 130.15873015873018 L 323.71791482634825, 133.33333333333331 L 323.71791482634825, 126.98412698412697 L 329.2164888186304, 130.15873015873018 M 329.2164888186304, 142.85714285714286 L 323.71791482634825, 146.03174603174602 L 323.71791482634825, 139.6825396825397 L 329.2164888186304, 142.85714285714286 M 329.2164888186304, 161.9047619047619 L 318.2193408340661, 168.25396825396825 L 318.2193408340661, 155.55555555555557 L 329.2164888186304, 161.9047619047619 M 318.2193408340661, 161.9047619047619 L 312.720766841784, 165.0793650793651 L 312.720766841784, 158.73015873015873 L 318.2193408340661, 161.9047619047619 M 329.2164888186304, 155.55555555555554 L 323.71791482634825, 158.73015873015873 L 323.71791482634825, 152.38095238095238 L 329.2164888186304, 155.55555555555554 M 329.2164888186304, 168.25396825396825 L 323.7179148263483, 171.42857142857144 L 323.7179148263483, 165.07936507936506 L 329.2164888186304, 168.25396825396825 M 373.2050807568876, 123.8095238095238 L 351.21078478775905, 136.5079365079365 L 351.210784787759, 111.11111111111111 L 373.2050807568876, 123.8095238095238 M 351.21078478775905, 123.80952380952381 L 340.21363680319473, 130.15873015873015 L 340.21363680319473, 117.46031746031746 L 351.21078478775905, 123.8095238095238 M 340.21363680319473, 123.80952380952381 L 334.71506281091257, 126.98412698412697 L 334.71506281091257, 120.63492063492065 L 340.21363680319473, 123.8095238095238 M 351.210784787759, 117.46031746031746 L 345.71221079547684, 120.63492063492063 L 345.71221079547684, 114.28571428571428 L 351.210784787759, 117.46031746031746 M 351.21078478775905, 130.15873015873015 L 345.71221079547684, 133.33333333333331 L 345.71221079547684, 126.98412698412697 L 351.21078478775905, 130.15873015873015 M 373.2050807568876, 111.1111111111111 L 362.20793277232326, 117.46031746031746 L 362.20793277232326, 104.76190476190474 L 373.2050807568876, 111.11111111111109 M 362.20793277232326, 111.1111111111111 L 356.70935878004116, 114.28571428571428 L 356.70935878004116, 107.93650793650794 L 362.20793277232326, 111.11111111111109 M 373.2050807568876, 104.76190476190474 L 367.7065067646055, 107.93650793650792 L 367.7065067646055, 101.58730158730157 L 373.2050807568876, 104.76190476190474 M 373.2050807568876, 117.46031746031744 L 367.7065067646055, 120.63492063492062 L 367.7065067646055, 114.28571428571428 L 373.2050807568876, 117.46031746031744 M 373.2050807568876, 136.5079365079365 L 362.2079327723233, 142.85714285714283 L 362.2079327723233, 130.15873015873015 L 373.2050807568876, 136.5079365079365 M 362.2079327723233, 136.5079365079365 L 356.70935878004116, 139.68253968253967 L 356.70935878004116, 133.33333333333331 L 362.2079327723233, 136.5079365079365 M 373.2050807568876, 130.15873015873012 L 367.7065067646055, 133.33333333333331 L 367.7065067646055, 126.98412698412697 L 373.2050807568876, 130.15873015873012 M 373.2050807568876, 142.85714285714283 L 367.7065067646055, 146.03174603174602 L 367.7065067646055, 139.68253968253967 L 373.2050807568876, 142.85714285714283 M 373.20508075688764, 174.6031746031746 L 351.21078478775905, 187.30158730158732 L 351.21078478775905, 161.9047619047619 L 373.20508075688764, 174.60317460317458 M 351.21078478775905, 174.6031746031746 L 340.21363680319473, 180.95238095238096 L 340.21363680319473, 168.25396825396825 L 351.21078478775905, 174.6031746031746 M 340.21363680319473, 174.6031746031746 L 334.7150628109126, 177.77777777777777 L 334.7150628109126, 171.42857142857144 L 340.21363680319473, 174.6031746031746 M 351.21078478775905, 168.25396825396825 L 345.7122107954769, 171.42857142857142 L 345.71221079547684, 165.07936507936506 L 351.21078478775905, 168.25396825396825 M 351.21078478775905, 180.95238095238093 L 345.7122107954769, 184.12698412698413 L 345.7122107954769, 177.77777777777777 L 351.21078478775905, 180.95238095238093 M 373.2050807568876, 161.9047619047619 L 362.2079327723233, 168.25396825396825 L 362.2079327723233, 155.55555555555554 L 373.2050807568876, 161.9047619047619 M 362.2079327723233, 161.9047619047619 L 356.70935878004116, 165.07936507936506 L 356.70935878004116, 158.73015873015873 L 362.2079327723233, 161.9047619047619 M 373.2050807568876, 155.55555555555554 L 367.7065067646055, 158.73015873015873 L 367.7065067646055, 152.38095238095235 L 373.2050807568876, 155.55555555555554 M 373.20508075688764, 168.25396825396825 L 367.7065067646055, 171.42857142857142 L 367.7065067646055, 165.07936507936506 L 373.20508075688764, 168.25396825396822 M 373.20508075688764, 187.3015873015873 L 362.2079327723234, 193.65079365079364 L 362.2079327723234, 180.95238095238093 L 373.20508075688764, 187.3015873015873 M 362.2079327723234, 187.3015873015873 L 356.70935878004116, 190.47619047619045 L 356.70935878004116, 184.12698412698413 L 362.2079327723234, 187.3015873015873 M 373.20508075688764, 180.95238095238093 L 367.7065067646055, 184.12698412698413 L 367.7065067646055, 177.77777777777777 L 373.20508075688764, 180.95238095238093 M 373.20508075688764, 193.65079365079364 L 367.7065067646055, 196.8253968253968 L 367.7065067646055, 190.47619047619045 L 373.20508075688764, 193.65079365079364 M 373.2050807568877, 301.5873015873016 L 285.22789688037335, 352.3809523809524 L 285.22789688037335, 250.79365079365084 L 373.2050807568877, 301.58730158730157 M 285.22789688037335, 301.5873015873016 L 241.23930494211612, 326.984126984127 L 241.23930494211612, 276.19047619047626 L 285.22789688037335, 301.5873015873016 M 241.23930494211612, 301.5873015873016 L 219.24500897298753, 314.28571428571433 L 219.24500897298753, 288.8888888888889 L 241.23930494211612, 301.5873015873016 M 219.24500897298753, 301.5873015873016 L 208.24786098842324, 307.93650793650795 L 208.24786098842324, 295.2380952380953 L 219.24500897298753, 301.5873015873016 M 208.24786098842324, 301.5873015873016 L 202.74928699614108, 304.7619047619048 L 202.74928699614108, 298.41269841269843 L 208.24786098842324, 301.5873015873016 M 219.24500897298753, 295.2380952380953 L 213.74643498070537, 298.41269841269843 L 213.74643498070537, 292.0634920634921 L 219.24500897298753, 295.2380952380953 M 219.24500897298753, 307.93650793650795 L 213.74643498070537, 311.11111111111114 L 213.74643498070537, 304.7619047619048 L 219.24500897298753, 307.93650793650795 M 241.23930494211612, 288.8888888888889 L 230.24215695755183, 295.2380952380953 L 230.24215695755183, 282.5396825396826 L 241.23930494211612, 288.8888888888889 M 230.24215695755183, 288.8888888888889 L 224.74358296526967, 292.0634920634921 L 224.74358296526967, 285.7142857142858 L 230.24215695755183, 288.8888888888889 M 241.23930494211612, 282.5396825396826 L 235.74073094983396, 285.7142857142858 L 235.74073094983396, 279.3650793650794 L 241.23930494211612, 282.5396825396826 M 241.23930494211612, 295.2380952380953 L 235.740730949834, 298.41269841269843 L 235.740730949834, 292.0634920634921 L 241.23930494211612, 295.2380952380953 M 241.23930494211612, 314.28571428571433 L 230.24215695755186, 320.63492063492066 L 230.24215695755183, 307.93650793650795 L 241.23930494211612, 314.28571428571433 M 230.24215695755183, 314.28571428571433 L 224.7435829652697, 317.46031746031747 L 224.7435829652697, 311.11111111111114 L 230.24215695755183, 314.28571428571433 M 241.23930494211612, 307.93650793650795 L 235.740730949834, 311.11111111111114 L 235.740730949834, 304.7619047619048 L 241.23930494211612, 307.93650793650795 M 241.23930494211615, 320.63492063492066 L 235.74073094983402, 323.80952380952385 L 235.74073094983402, 317.46031746031747 L 241.23930494211615, 320.63492063492066 M 285.22789688037335, 276.1904761904762 L 263.2336009112447, 288.8888888888889 L 263.2336009112447, 263.4920634920635 L 285.2278968803733, 276.1904761904762 M 263.2336009112447, 276.1904761904762 L 252.2364529266804, 282.5396825396826 L 252.2364529266804, 269.8412698412699 L 263.2336009112447, 276.1904761904762 M 252.2364529266804, 276.1904761904762 L 246.73787893439825, 279.3650793650794 L 246.73787893439825, 273.015873015873 L 252.2364529266804, 276.1904761904762 M 263.2336009112447, 269.8412698412699 L 257.73502691896255, 273.015873015873 L 257.73502691896255, 266.6666666666667 L 263.2336009112447, 269.8412698412699 M 263.2336009112447, 282.5396825396826 L 257.7350269189626, 285.7142857142857 L 257.7350269189626, 279.3650793650794 L 263.2336009112447, 282.5396825396826 M 285.2278968803733, 263.4920634920635 L 274.23074889580903, 269.8412698412699 L 274.23074889580903, 257.14285714285717 L 285.2278968803733, 263.4920634920635 M 274.23074889580903, 263.4920634920635 L 268.73217490352687, 266.6666666666667 L 268.73217490352687, 260.31746031746036 L 274.23074889580903, 263.4920634920635 M 285.2278968803733, 257.14285714285717 L 279.72932288809113, 260.31746031746036 L 279.72932288809113, 253.96825396825398 L 285.2278968803733, 257.14285714285717 M 285.2278968803733, 269.8412698412699 L 279.72932288809113, 273.015873015873 L 279.72932288809113, 266.6666666666667 L 285.2278968803733, 269.8412698412699 M 285.22789688037335, 288.8888888888889 L 274.23074889580903, 295.2380952380953 L 274.23074889580903, 282.5396825396826 L 285.22789688037335, 288.8888888888889 M 274.23074889580903, 288.8888888888889 L 268.73217490352687, 292.0634920634921 L 268.73217490352687, 285.7142857142857 L 274.23074889580903, 288.8888888888889 M 285.22789688037335, 282.53968253968253 L 279.7293228880912, 285.7142857142857 L 279.7293228880912, 279.3650793650794 L 285.22789688037335, 282.53968253968253 M 285.22789688037335, 295.2380952380953 L 279.7293228880912, 298.41269841269843 L 279.7293228880912, 292.06349206349205 L 285.22789688037335, 295.23809523809524 M 285.22789688037335, 326.984126984127 L 263.23360091124476, 339.6825396825397 L 263.23360091124476, 314.28571428571433 L 285.22789688037335, 326.984126984127 M 263.23360091124476, 326.984126984127 L 252.23645292668044, 333.33333333333337 L 252.23645292668044, 320.63492063492066 L 263.23360091124476, 326.984126984127 M 252.23645292668044, 326.984126984127 L 246.7378789343983, 330.1587301587302 L 246.7378789343983, 323.80952380952385 L 252.23645292668044, 326.984126984127 M 263.23360091124476, 320.63492063492066 L 257.7350269189626, 323.8095238095238 L 257.7350269189626, 317.46031746031747 L 263.23360091124476, 320.63492063492066 M 263.23360091124476, 333.33333333333337 L 257.7350269189626, 336.5079365079365 L 257.7350269189626, 330.1587301587302 L 263.23360091124476, 333.33333333333337 M 285.22789688037335, 314.28571428571433 L 274.23074889580903, 320.63492063492066 L 274.23074889580903, 307.93650793650795 L 285.22789688037335, 314.2857142857143 M 274.23074889580903, 314.28571428571433 L 268.7321749035269, 317.46031746031747 L 268.7321749035269, 311.11111111111114 L 274.23074889580903, 314.28571428571433 M 285.22789688037335, 307.93650793650795 L 279.7293228880912, 311.11111111111114 L 279.7293228880912, 304.7619047619048 L 285.22789688037335, 307.93650793650795 M 285.22789688037335, 320.63492063492066 L 279.7293228880912, 323.8095238095238 L 279.7293228880912, 317.46031746031747 L 285.22789688037335, 320.63492063492066 M 285.22789688037335, 339.6825396825397 L 274.23074889580903, 346.031746031746 L 274.23074889580903, 333.33333333333337 L 285.22789688037335, 339.6825396825397 M 274.23074889580903, 339.6825396825397 L 268.7321749035269, 342.8571428571429 L 268.7321749035269, 336.5079365079365 L 274.23074889580903, 339.6825396825397 M 285.22789688037335, 333.33333333333337 L 279.7293228880912, 336.5079365079365 L 279.7293228880912, 330.1587301587302 L 285.22789688037335, 333.33333333333337 M 285.22789688037335, 346.031746031746 L 279.72932288809125, 349.2063492063492 L 279.72932288809125, 342.8571428571429 L 285.22789688037335, 346.031746031746 M 373.2050807568877, 250.7936507936508 L 329.2164888186305, 276.1904761904762 L 329.21648881863047, 225.39682539682542 L 373.2050807568877, 250.79365079365078 M 329.2164888186305, 250.7936507936508 L 307.2221928495019, 263.4920634920635 L 307.2221928495019, 238.0952380952381 L 329.2164888186305, 250.79365079365078 M 307.2221928495019, 250.7936507936508 L 296.2250448649376, 257.14285714285717 L 296.2250448649376, 244.44444444444446 L 307.2221928495019, 250.7936507936508 M 296.2250448649376, 250.7936507936508 L 290.72647087265545, 253.96825396825398 L 290.72647087265545, 247.61904761904765 L 296.2250448649376, 250.7936507936508 M 307.2221928495019, 244.44444444444446 L 301.7236188572198, 247.61904761904765 L 301.7236188572198, 241.26984126984127 L 307.2221928495019, 244.44444444444446 M 307.2221928495019, 257.14285714285717 L 301.7236188572198, 260.3174603174603 L 301.7236188572198, 253.96825396825398 L 307.2221928495019, 257.14285714285717 M 329.21648881863047, 238.0952380952381 L 318.2193408340662, 244.44444444444446 L 318.2193408340662, 231.74603174603175 L 329.21648881863047, 238.0952380952381 M 318.2193408340662, 238.0952380952381 L 312.72076684178404, 241.26984126984127 L 312.72076684178404, 234.92063492063494 L 318.2193408340662, 238.0952380952381 M 329.21648881863047, 231.74603174603175 L 323.7179148263483, 234.92063492063494 L 323.7179148263483, 228.57142857142856 L 329.21648881863047, 231.74603174603175 M 329.2164888186305, 244.44444444444446 L 323.71791482634836, 247.61904761904762 L 323.71791482634836, 241.26984126984127 L 329.2164888186305, 244.44444444444446 M 329.2164888186305, 263.4920634920635 L 318.2193408340662, 269.8412698412699 L 318.2193408340662, 257.14285714285717 L 329.2164888186305, 263.4920634920635 M 318.2193408340662, 263.4920634920635 L 312.72076684178404, 266.6666666666667 L 312.72076684178404, 260.3174603174603 L 318.2193408340662, 263.4920634920635 M 329.2164888186305, 257.14285714285717 L 323.71791482634836, 260.3174603174603 L 323.71791482634836, 253.96825396825398 L 329.2164888186305, 257.1428571428571 M 329.2164888186305, 269.8412698412699 L 323.71791482634836, 273.015873015873 L 323.71791482634836, 266.6666666666667 L 329.2164888186305, 269.8412698412698 M 373.2050807568877, 225.3968253968254 L 351.21078478775905, 238.0952380952381 L 351.21078478775905, 212.69841269841268 L 373.2050807568877, 225.3968253968254 M 351.21078478775905, 225.3968253968254 L 340.21363680319473, 231.74603174603175 L 340.21363680319473, 219.04761904761904 L 351.21078478775905, 225.3968253968254 M 340.21363680319473, 225.3968253968254 L 334.7150628109126, 228.57142857142856 L 334.7150628109126, 222.22222222222223 L 340.21363680319473, 225.3968253968254 M 351.21078478775905, 219.04761904761904 L 345.71221079547695, 222.22222222222223 L 345.71221079547695, 215.87301587301587 L 351.21078478775905, 219.04761904761904 M 351.21078478775905, 231.74603174603175 L 345.71221079547695, 234.92063492063494 L 345.71221079547695, 228.57142857142856 L 351.21078478775905, 231.74603174603175 M 373.2050807568877, 212.69841269841268 L 362.2079327723234, 219.04761904761904 L 362.2079327723234, 206.34920634920633 L 373.2050807568877, 212.69841269841268 M 362.2079327723234, 212.69841269841268 L 356.7093587800412, 215.87301587301587 L 356.7093587800412, 209.52380952380952 L 362.2079327723234, 212.69841269841268 M 373.2050807568877, 206.34920634920633 L 367.7065067646055, 209.52380952380952 L 367.7065067646055, 203.17460317460316 L 373.2050807568877, 206.34920634920633 M 373.2050807568877, 219.04761904761904 L 367.7065067646055, 222.22222222222223 L 367.7065067646055, 215.87301587301587 L 373.2050807568877, 219.04761904761904 M 373.2050807568877, 238.09523809523807 L 362.2079327723234, 244.44444444444443 L 362.2079327723234, 231.74603174603175 L 373.2050807568877, 238.09523809523807 M 362.2079327723234, 238.0952380952381 L 356.7093587800412, 241.26984126984127 L 356.7093587800412, 234.9206349206349 L 362.2079327723234, 238.09523809523807 M 373.2050807568877, 231.74603174603175 L 367.7065067646055, 234.9206349206349 L 367.7065067646055, 228.57142857142856 L 373.2050807568877, 231.74603174603175 M 373.2050807568877, 244.44444444444443 L 367.70650676460554, 247.61904761904762 L 367.70650676460554, 241.26984126984127 L 373.2050807568877, 244.44444444444443 M 373.2050807568877, 276.1904761904762 L 351.2107847877591, 288.8888888888889 L 351.2107847877591, 263.4920634920635 L 373.2050807568877, 276.19047619047615 M 351.2107847877591, 276.1904761904762 L 340.21363680319485, 282.53968253968253 L 340.21363680319485, 269.8412698412698 L 351.2107847877591, 276.1904761904762 M 340.21363680319485, 276.1904761904762 L 334.7150628109127, 279.36507936507934 L 334.7150628109127, 273.015873015873 L 340.21363680319485, 276.1904761904762 M 351.2107847877591, 269.8412698412698 L 345.71221079547695, 273.015873015873 L 345.71221079547695, 266.6666666666667 L 351.2107847877591, 269.8412698412698 M 351.2107847877591, 282.53968253968253 L 345.71221079547695, 285.7142857142857 L 345.71221079547695, 279.36507936507934 L 351.2107847877591, 282.53968253968253 M 373.2050807568877, 263.4920634920635 L 362.2079327723234, 269.8412698412698 L 362.2079327723234, 257.1428571428571 L 373.2050807568877, 263.4920634920635 M 362.2079327723234, 263.4920634920635 L 356.70935878004127, 266.66666666666663 L 356.70935878004127, 260.3174603174603 L 362.2079327723234, 263.4920634920635 M 373.2050807568877, 257.1428571428571 L 367.70650676460554, 260.3174603174603 L 367.70650676460554, 253.96825396825398 L 373.2050807568877, 257.1428571428571 M 373.2050807568877, 269.8412698412698 L 367.7065067646056, 273.015873015873 L 367.7065067646056, 266.66666666666663 L 373.2050807568877, 269.8412698412698 M 373.2050807568877, 288.8888888888889 L 362.20793277232343, 295.23809523809524 L 362.20793277232343, 282.53968253968253 L 373.2050807568877, 288.8888888888889 M 362.20793277232343, 288.8888888888889 L 356.70935878004127, 292.06349206349205 L 356.70935878004127, 285.7142857142857 L 362.20793277232343, 288.8888888888889 M 373.2050807568877, 282.53968253968253 L 367.7065067646056, 285.71428571428567 L 367.7065067646056, 279.36507936507934 L 373.2050807568877, 282.53968253968253 M 373.2050807568877, 295.23809523809524 L 367.7065067646056, 298.41269841269843 L 367.7065067646056, 292.06349206349205 L 373.2050807568877, 295.23809523809524 M 373.2050807568878, 352.3809523809524 L 329.2164888186306, 377.7777777777778 L 329.2164888186306, 326.984126984127 L 373.2050807568878, 352.3809523809524 M 329.2164888186306, 352.3809523809524 L 307.222192849502, 365.0793650793651 L 307.222192849502, 339.6825396825397 L 329.2164888186306, 352.3809523809524 M 307.222192849502, 352.3809523809524 L 296.2250448649377, 358.73015873015873 L 296.2250448649377, 346.031746031746 L 307.222192849502, 352.3809523809524 M 296.2250448649377, 352.3809523809524 L 290.7264708726555, 355.5555555555556 L 290.7264708726555, 349.2063492063492 L 296.2250448649377, 352.3809523809524 M 307.222192849502, 346.031746031746 L 301.72361885721983, 349.2063492063492 L 301.72361885721983, 342.8571428571429 L 307.222192849502, 346.031746031746 M 307.222192849502, 358.73015873015873 L 301.72361885721983, 361.9047619047619 L 301.72361885721983, 355.5555555555556 L 307.222192849502, 358.73015873015873 M 329.2164888186306, 339.6825396825397 L 318.21934083406626, 346.031746031746 L 318.21934083406626, 333.33333333333337 L 329.2164888186305, 339.6825396825397 M 318.21934083406626, 339.6825396825397 L 312.7207668417841, 342.8571428571429 L 312.7207668417841, 336.5079365079365 L 318.21934083406626, 339.6825396825397 M 329.2164888186305, 333.33333333333337 L 323.7179148263484, 336.5079365079365 L 323.7179148263484, 330.1587301587302 L 329.2164888186305, 333.33333333333337 M 329.2164888186306, 346.031746031746 L 323.7179148263484, 349.2063492063492 L 323.7179148263484, 342.8571428571429 L 329.2164888186306, 346.031746031746 M 329.2164888186306, 365.07936507936506 L 318.21934083406626, 371.42857142857144 L 318.21934083406626, 358.73015873015873 L 329.2164888186306, 365.07936507936506 M 318.21934083406626, 365.07936507936506 L 312.7207668417841, 368.2539682539683 L 312.7207668417841, 361.9047619047619 L 318.21934083406626, 365.07936507936506 M 329.2164888186306, 358.73015873015873 L 323.7179148263484, 361.9047619047619 L 323.7179148263484, 355.55555555555554 L 329.2164888186306, 358.73015873015873 M 329.2164888186306, 371.42857142857144 L 323.7179148263484, 374.6031746031746 L 323.7179148263484, 368.2539682539683 L 329.2164888186306, 371.42857142857144 M 373.20508075688775, 326.984126984127 L 351.21078478775917, 339.6825396825397 L 351.21078478775917, 314.2857142857143 L 373.20508075688775, 326.984126984127 M 351.21078478775917, 326.984126984127 L 340.21363680319485, 333.33333333333337 L 340.21363680319485, 320.63492063492066 L 351.21078478775917, 326.984126984127 M 340.21363680319485, 326.984126984127 L 334.71506281091274, 330.1587301587302 L 334.71506281091274, 323.8095238095238 L 340.21363680319485, 326.984126984127 M 351.21078478775917, 320.63492063492066 L 345.712210795477, 323.8095238095238 L 345.712210795477, 317.46031746031747 L 351.21078478775917, 320.63492063492066 M 351.21078478775917, 333.33333333333337 L 345.712210795477, 336.5079365079365 L 345.712210795477, 330.1587301587302 L 351.21078478775917, 333.33333333333337 M 373.2050807568877, 314.2857142857143 L 362.2079327723235, 320.63492063492066 L 362.20793277232343, 307.93650793650795 L 373.2050807568877, 314.2857142857143 M 362.20793277232343, 314.2857142857143 L 356.70935878004127, 317.46031746031747 L 356.70935878004127, 311.1111111111111 L 362.20793277232343, 314.2857142857143 M 373.2050807568877, 307.93650793650795 L 367.7065067646056, 311.1111111111111 L 367.7065067646056, 304.76190476190476 L 373.2050807568877, 307.93650793650795 M 373.2050807568877, 320.6349206349206 L 367.7065067646056, 323.8095238095238 L 367.7065067646056, 317.46031746031747 L 373.2050807568877, 320.6349206349206 M 373.2050807568878, 339.6825396825397 L 362.2079327723235, 346.031746031746 L 362.2079327723235, 333.33333333333337 L 373.2050807568878, 339.68253968253964 M 362.2079327723235, 339.6825396825397 L 356.70935878004127, 342.8571428571429 L 356.70935878004127, 336.5079365079365 L 362.2079327723235, 339.6825396825397 M 373.20508075688775, 333.33333333333337 L 367.7065067646056, 336.5079365079365 L 367.7065067646056, 330.1587301587302 L 373.20508075688775, 333.33333333333337 M 373.2050807568878, 346.031746031746 L 367.7065067646056, 349.2063492063492 L 367.7065067646056, 342.8571428571429 L 373.2050807568878, 346.031746031746 M 373.2050807568878, 377.7777777777778 L 351.21078478775917, 390.4761904761905 L 351.21078478775917, 365.07936507936506 L 373.2050807568878, 377.7777777777777 M 351.21078478775917, 377.7777777777778 L 340.21363680319485, 384.1269841269841 L 340.21363680319485, 371.42857142857144 L 351.21078478775917, 377.7777777777778 M 340.21363680319485, 377.7777777777778 L 334.71506281091274, 380.95238095238096 L 334.71506281091274, 374.6031746031746 L 340.21363680319485, 377.7777777777778 M 351.21078478775917, 371.42857142857144 L 345.71221079547706, 374.6031746031746 L 345.71221079547706, 368.2539682539683 L 351.21078478775917, 371.42857142857144 M 351.21078478775917, 384.1269841269841 L 345.71221079547706, 387.30158730158735 L 345.71221079547706, 380.95238095238096 L 351.21078478775917, 384.1269841269841 M 373.2050807568878, 365.07936507936506 L 362.2079327723235, 371.42857142857144 L 362.2079327723235, 358.73015873015873 L 373.2050807568878, 365.07936507936506 M 362.2079327723235, 365.07936507936506 L 356.7093587800413, 368.2539682539683 L 356.7093587800413, 361.9047619047619 L 362.2079327723235, 365.07936507936506 M 373.2050807568878, 358.73015873015873 L 367.7065067646056, 361.9047619047619 L 367.7065067646056, 355.55555555555554 L 373.2050807568878, 358.7301587301587 M 373.2050807568878, 371.42857142857144 L 367.7065067646056, 374.6031746031746 L 367.7065067646056, 368.2539682539683 L 373.2050807568878, 371.42857142857144 M 373.2050807568878, 390.4761904761905 L 362.2079327723235, 396.82539682539687 L 362.2079327723235, 384.1269841269841 L 373.2050807568878, 390.4761904761905 M 362.2079327723235, 390.4761904761905 L 356.7093587800414, 393.6507936507936 L 356.7093587800413, 387.30158730158735 L 362.2079327723235, 390.4761904761905 M 373.2050807568878, 384.1269841269841 L 367.7065067646056, 387.30158730158735 L 367.7065067646056, 380.95238095238096 L 373.2050807568878, 384.1269841269841 M 373.2050807568878, 396.82539682539687 L 367.70650676460565, 400 L 367.70650676460565, 393.6507936507936 L 373.2050807568878, 396.82539682539675 \"/></svg>")

(defn download-blob! [filename blob]
(let[download-link (. js/document (createElement "a"))]
 (do
    (set! (.-download download-link) filename)
    (set! (.-href download-link) (.createObjectURL js/URL blob))
     (.click download-link))))


(defn save-canvas! [filename canvas]
  (let[gif (js/GIF. #js {:workers 4
                         :quality 1
                         :width (.-width canvas) 
                         :height  (.-height canvas)
                         :workerScript worker-url
                         })
       context (.getContext canvas "2d")]
    (do
      (.addFrame gif context #js {:copy true :delay 200})
      (.on gif "finished" (fn[blob](download-blob! filename blob)));; partial does not work ?!
           (.render gif))))
(defn save-image! [filename img]
  (let[gif (js/GIF. #js {:workers 4
                         :quality 1
                         :workerScript worker-url
                         })]
    (do
      (.addFrame gif img #js {:copy true :delay 200})
      (.on gif "finished" (fn[blob](download-blob! filename blob)));; partial does not work ?!
           (.render gif))))
(defn save-svg![filename svg]
  (let [img (js/Image.)
        svg-url (str->url (reagent.dom.server/render-to-static-markup svg) "image/svg+xml")]
    (do 
      (set! (.-onload img)
            (fn[] (save-image! filename canvas)))
      (set! (.-src img) svg-url)
      svg)))
(defn save-svgs![filename delays svgs]
  (let [delays (if (number? delays) (repeat delays) delays)
       [w h] ((comp (juxt :width :height) second first) svgs)
         gif (js/GIF. #js {:workers 4
                          :quality 1
                          :width w
                          :height h
                          :workerScript worker-url
                          })
        process (fn process[svgs delays](let[img (js/Image.)
                                             svg-url (str->url (reagent.dom.server/render-to-static-markup 
                                                                 (first svgs))
                                                               "image/svg+xml")]
                                          (do
                                            (set! (.-onload img)
                                                  (fn[](do
                                                         (.addFrame gif img #js{:copy true :delay (first delays)})
                                                         (let[r (rest svgs)]
                                                           (if (seq r)
                                                             (process r (rest delays))
                                                             (.render gif)
                                                             )))))
                                            (set! (.-src img) svg-url))))]
    (do
      (.on gif "finished" (fn[blob](download-blob! filename blob)));; partial does not work ?!
      (process svgs delays)
      svgs)))
(defn bezier-step [ps t]
(condp = (count ps)
1 (first ps)
2 (let[[p0 p1] ps] (weighted-mean t p0 p1))
3 (let[[p0 p1 p2] ps] (add (scale (* (- 1 t) (- 1 t)) p0) (add (scale (* 2 t (- 1 t)) p1) (scale (* t t) p2))))
(bezier-step (map (partial weighted-mean t) (partition 2 1 ps)) t)))

(defn bezier [n ps]
(if (< (count ps) 2) ps (mapv (comp (partial bezier-step ps) (partial * (/ 1 n))) (range (inc n)))))
(defn square-curve[n p0-p2 angle]
(let[inv-sqrt-2 (/ 1. (sqrt 2))
  p01 (weighted-mean inv-sqrt-2 p0-p2)
  p21 (weighted-mean (- 1. inv-sqrt-2) p0-p2)
  [p0 p2] p0-p2
  p1  (weighted-mean 0.5 [((make-rotate-around p0 (/ angle 2)) p01)
                          ((make-rotate-around p2 (/ angle -2)) p21)])]
                          (bezier n [p0 p1 p2])))

(defn square-with-curve [n angle]
(let[square (regular-polygon 4)]
[square (square-curve n [(first square)(nth square 2)] angle)]))
(defn power [x n] (nth (iterate (partial * x) 1) n))
(defn squares-params-f[angle invertRatio]
  (let[golden-ratio (/ 2. (+ 1. (sqrt 5)))
       [factor ratio a] (if invertRatio [-1 (/ 1. golden-ratio) angle ]
                                        [1 golden-ratio (- angle)])]
    [[] [(make-polylines-transform (comp (make-rotate-around [factor 0] a)
                                         (partial add [(* factor (+ 1. ratio)) 0])
                                         (partial scale ratio)))
         ;; should use (power ratio ?)
         (fn[n](square-with-curve (max 1 (if invertRatio (+ 10 n) (- 10 n))) 
                                  (* factor a)))]]))
         (defn fractal-step-f [[step-f step-elts-f] [current-elts i]]
  (into (step-elts-f i) (step-f current-elts)))

(defn params->params-f [[init-elts [step-f step-elts]]] [init-elts [step-f (constantly step-elts)]])

(defn fractal-f [[init-elts step-params-f] details]
  (reduce (fn[current-elts i] (fractal-step-f step-params-f [current-elts i])) init-elts (range (dec details) -1 -1)))
(def golden-squares-state (reagent.core/atom {:angle (/ PI -2) }))
(defn gui-golden-squares[]
  (let[angle (:angle @golden-squares-state)]
    [:div 
     [:div [:input {:type "range" :value (:angle @golden-squares-state) :step 0.01 :min (/ PI -2)  :max (/ PI 2)  :style {:width "90%"}
                    :on-change (fn[e] (swap! golden-squares-state assoc 
:angle (js/parseFloat (.-target.value e))))}]]
[draw-fitted-polylines [400 400](fractal-f (squares-params-f angle false) 4)]]))
(defn centered-golden-squares[[dx zoom angle] [details-inc details-dec]]
  ((make-polylines-transform (comp (partial add [(+ dx) 0]) (partial rotate (* angle -0.5)) (partial scale zoom)))
   (into (fractal-f (squares-params-f angle true) details-inc) (fractal-f (squares-params-f angle false) details-dec))))

(defn inclusive-range [n [[first last] times]]
  (if (== times 1) (mapv (comp (partial + first) (partial * (/ (- last first) n))) (range n))
    (into (inclusive-range (quot n times) [[first last] 1]) (inclusive-range (- n (quot n times)) [[last first] (dec times)]))))

(defn golden-squares-anim-params [n1 n2]
  (let[golden-ratio (/ 2. (+ 1. (sqrt 5)))
       with-break (fn[c](let[h (quot n1 2)
                             half-1 (vec (take h c))
                             half-2 (drop h c)]
                          (-> half-1 (into (repeat n2 (first half-2)))
                                      (into half-2))))
       dx (with-break (inclusive-range n1 [[0 (/ (+ 1 golden-ratio) golden-ratio)] 1]))
       dx (into dx dx)
       zoom (with-break (inclusive-range n1 [[(/ (+ 1 (sqrt 5)) 2) 1] 1]))
       zoom (into zoom zoom)
       angles (into (with-break (inclusive-range n1 [[0 (/ PI 2)] 2]))
                          (with-break (inclusive-range n1 [[0 (/ PI -2)] 2])))]
    (mapv vector dx zoom angles)))
(def golden-squares-anim-state (reagent.core/atom {:step 0 }))
(def anim-params (golden-squares-anim-params 100 10))
(def data (into anim-params anim-params))
(def wh [1024 512])
(def details [5 8])
;; comment fitting-tranform def to speed things up
(def fitting-transform (make-polylines-transform (make-fitting-transform wh 
                                                                         (reduce into [] (map (fn[p] (centered-golden-squares p
                                                                                                        [0 5])) anim-params)))))
(defn gui-golden-squares[]
  (let[step (:step @golden-squares-anim-state)
       n-steps (count data)]
    [:div
     [:div [:input {:type "range" :value (:step @golden-squares-anim-state) :min 0  :max n-steps :style {:width "90%"}
                    :on-change (fn[e] (swap! golden-squares-anim-state assoc 
                                             :step (js/parseFloat (.-target.value e))))}]]
     [draw-polylines wh (fitting-transform (centered-golden-squares (nth data step) details))]]))
</code></pre>



<pre><code class="reagent" data-loop-msec="25" >

(def wh [1024 512])
(def details [5 8])
(defn get-date[] (.getTime (js/Date.)))
[draw-polylines wh (fitting-transform 
                     (centered-golden-squares (nth anim-params (mod (int (/ (get-date) 50))
                                                             (count anim-params))) details))]
</code></pre>

<pre><code class="reagent">

(def golden-squares-state (reagent.core/atom {:angle (/ PI -2) }))
(defn gui-golden-squares[]
  (let[angle (:angle @golden-squares-state)]
    [:div 
     [:div [:input {:type "range" :value (:angle @golden-squares-state) :step 0.01 :min (/ PI -2)  :max (/ PI 2)  :style {:width "90%"}
                    :on-change (fn[e] (swap! golden-squares-state assoc 
:angle (js/parseFloat (.-target.value e))))}]]
[draw-fitted-polylines [400 400](fractal-f (squares-params-f angle false) 4)]]))
</code></pre>

<pre><code class="reagent">

(def golden-squares-state-2 (reagent.core/atom {:angle (/ PI -2) }))
(defn gui-golden-squares-2[]
  (let[angle (:angle @golden-squares-state-2)]
    [:div 
     [:div [:input {:type "range" :value (:angle @golden-squares-state-2) :step 0.01 :min (/ PI -2)  :max (/ PI 2)  :style {:width "90%"}
                    :on-change (fn[e] (swap! golden-squares-state-2 assoc 
:angle (js/parseFloat (.-target.value e))))}]]
     [draw-fitted-polylines [512 512](let[f1 (fractal-f (squares-params-f angle false) 12)]
                                   ((make-polylines-transform (partial rotate (/ angle -2)))(reduce into [] [f1 ((make-polylines-transform (comp (make-rotate-around [-1 0] angle)(partial add [-2 0])
                                                                                        (fn[[x y]][(- x) y]))) f1)])))]]))
</code></pre>

<pre><code class="reagent">

(defn centered-golden-squares[[dx zoom angle] [details-inc details-dec]]
  ((make-polylines-transform (comp (partial add [(+ dx) 0]) (partial rotate (* angle -0.5)) (partial scale zoom)))
   (into (fractal-f (squares-params-f angle true) details-inc) (fractal-f (squares-params-f angle false) details-dec))))

(defn inclusive-range [n [[first last] times]]
  (if (== times 1) (mapv (comp (partial + first) (partial * (/ (- last first) n))) (range n))
    (into (inclusive-range (quot n times) [[first last] 1]) (inclusive-range (- n (quot n times)) [[last first] (dec times)]))))

(defn golden-squares-anim-params [n1 n2]
  (let[golden-ratio (/ 2. (+ 1. (sqrt 5)))
       with-break (fn[c](let[h (quot n1 2)
                             half-1 (vec (take h c))
                             half-2 (drop h c)]
                          (-> half-1 (into (repeat n2 (first half-2)))
                                      (into half-2))))
       dx (with-break (inclusive-range n1 [[0 (/ (+ 1 golden-ratio) golden-ratio)] 1]))
       dx (into dx dx)
       zoom (with-break (inclusive-range n1 [[(/ (+ 1 (sqrt 5)) 2) 1] 1]))
       zoom (into zoom zoom)
       angles (into (with-break (inclusive-range n1 [[0 (/ PI 2)] 2]))
                          (with-break (inclusive-range n1 [[0 (/ PI -2)] 2])))]
    (mapv vector dx zoom angles)))
[draw-fitted-polylines [400 400](centered-golden-squares (nth (golden-squares-anim-params 100 10) 55) [4 4])]
</code></pre>

<pre><code class="reagent">

         (defn fractal-step-f [[step-f step-elts-f] [current-elts i]]
  (into (step-elts-f i) (step-f current-elts)))

(defn params->params-f [[init-elts [step-f step-elts]]] [init-elts [step-f (constantly step-elts)]])

(defn fractal-f [[init-elts step-params-f] details]
  (reduce (fn[current-elts i] (fractal-step-f step-params-f [current-elts i])) init-elts (range (dec details) -1 -1)))
[draw-fitted-polylines [400 400](fractal-f (squares-params-f (/ PI 4) false) 4)]
</code></pre>

<pre><code class="reagent">

(defn power [x n] (nth (iterate (partial * x) 1) n))
(defn squares-params-f[angle invertRatio]
  (let[golden-ratio (/ 2. (+ 1. (sqrt 5)))
       [factor ratio a] (if invertRatio [-1 (/ 1. golden-ratio) angle ]
                                        [1 golden-ratio (- angle)])]
    [[] [(make-polylines-transform (comp (make-rotate-around [factor 0] a)
                                         (partial add [(* factor (+ 1. ratio)) 0])
                                         (partial scale ratio)))
         ;; should use (power ratio ?)
         (fn[n](square-with-curve (max 1 (if invertRatio (+ 10 n) (- 10 n))) 
                                  (* factor a)))]]))
[draw-fitted-polylines [400 400]
 (let[[init [step-f step-elts-f]] (squares-params-f (/ PI 4) false)]
     (step-f (step-elts-f 5)))]
</code></pre>

<pre><code class="reagent">

(defn square-curve[n p0-p2 angle]
(let[inv-sqrt-2 (/ 1. (sqrt 2))
  p01 (weighted-mean inv-sqrt-2 p0-p2)
  p21 (weighted-mean (- 1. inv-sqrt-2) p0-p2)
  [p0 p2] p0-p2
  p1  (weighted-mean 0.5 [((make-rotate-around p0 (/ angle 2)) p01)
                          ((make-rotate-around p2 (/ angle -2)) p21)])]
                          (bezier n [p0 p1 p2])))

(defn square-with-curve [n angle]
(let[square (regular-polygon 4)]
[square (square-curve n [(first square)(nth square 2)] angle)]))
[draw-fitted-polylines [400 400] (square-with-curve 10 (/ PI 4))] 
</code></pre>

<pre><code class="reagent">

(defn bezier-step [ps t]
(condp = (count ps)
1 (first ps)
2 (let[[p0 p1] ps] (weighted-mean t p0 p1))
3 (let[[p0 p1 p2] ps] (add (scale (* (- 1 t) (- 1 t)) p0) (add (scale (* 2 t (- 1 t)) p1) (scale (* t t) p2))))
(bezier-step (map (partial weighted-mean t) (partition 2 1 ps)) t)))

(defn bezier [n ps]
(if (< (count ps) 2) ps (mapv (comp (partial bezier-step ps) (partial * (/ 1 n))) (range (inc n)))))
(def ctrl-pts [[0 0][0 1][2 1]])
[draw-fitted-polylines [400 400] [ctrl-pts (bezier 16 ctrl-pts)]]
</code></pre>

<pre><code class="klipse">

(defn weighted-mean [t [p0 p1]]
(add (scale (- 1 t) p0) (scale t p1)))
(weighted-mean 0.25 [[0 1] [1 2]])
</code></pre>


<pre><code class="klipse">
(;; <- no auto save !
(save-svgs! "golden-squares-5-8.gif" 200 (map (fn[p](draw-polylines [1024 512] (fitting-transform 
                     (centered-golden-squares p [5 8])))) anim-params))
</code></pre>




<script>
window.klipse_settings = {
  selector: '.klipse',
  selector_reagent: '.reagent'
};
</script>
<script src="https://storage.googleapis.com/app.klipse.tech/plugin/js/klipse_plugin.js"></script>

<p>
test
</p>
